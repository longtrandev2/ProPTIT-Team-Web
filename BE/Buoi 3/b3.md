- [\[BUá»”I 3\] SQL cÆ¡ báº£n](#buá»•i-3-sql-cÆ¡-báº£n)
- [ðŸŒˆ Ná»™i dung cáº§n chuáº©n bá»‹.](#-ná»™i-dung-cáº§n-chuáº©n-bá»‹)
- [CÃ¡c thao tÃ¡c cÆ¡ báº£n: SELECT, INSERT, UPDATE, DELETE, tá»« khÃ³a AS, DISTINCT](#cÃ¡c-thao-tÃ¡c-cÆ¡-báº£n-select-insert-update-delete-tá»«-khÃ³a-as-distinct)
  - [Lá»c dá»¯ liá»‡u: WHERE, HAVING](#lá»c-dá»¯-liá»‡u-where-having)
  - [Káº¿t há»£p báº£ng vÃ  káº¿t quáº£: JOIN, UNION](#káº¿t-há»£p-báº£ng-vÃ -káº¿t-quáº£-join-union)
  - [Tá»•ng há»£p vÃ  nhÃ³m dá»¯ liá»‡u: COUNT, SUM, AVG, GROUP BY](#tá»•ng-há»£p-vÃ -nhÃ³m-dá»¯-liá»‡u-count-sum-avg-group-by)
  - [Truy váº¥n con: Subquery](#truy-váº¥n-con-subquery)
  - [Thá»© tá»± thá»±c thi logic cá»§a truy váº¥n](#thá»©-tá»±-thá»±c-thi-logic-cá»§a-truy-váº¥n)
- [â­ï¸ BÃ i táº­p trÆ°á»›c buá»•i há»c](#ï¸-bÃ i-táº­p-trÆ°á»›c-buá»•i-há»c)
  - [Leetcode - 584](#leetcode---584)
  - [Leetcode - 1378](#leetcode---1378)
  - [Leetcode - 1141](#leetcode---1141)

# [BUá»”I 3] SQL cÆ¡ báº£n

# ðŸŒˆ Ná»™i dung cáº§n chuáº©n bá»‹.
### CÃ¡c lá»‡nh cÆ¡ báº£n
- **Táº¡o cÆ¡ sá»Ÿ dá»¯ liá»‡u**
```sql
create database HoSoSinhVien
on (name='HSSV_data', filename='c:HSSV_data.mdf')
log on (name='HSSV_log', filename='c:HSSV_log.ldf')
```

- **XÃ³a cÆ¡ sá»Ÿ dá»¯ liá»‡u**
```sql
drop database HoSoSinhVien
```

- **Sá»­a thÃ´ng tin cÆ¡ sá»Ÿ dá»¯ liá»‡u**
```sql
alter database HoSoSinhVien
modify name = HSSV
```

- **Sá»­ dá»¥ng sp_dboption**
```sql
exec sp_dboption HoSoSinhVien, 'read only', 'true'
exec sp_dboption HoSoSinhVien, 'autoshrink', 'true'
exec sp_dboption HoSoSinhVien, 'single_user'
```

- **DBCC**
```sql
dbcc shrinkdatabase(HoSoSinhVien, 10)
```

---

## 2) TrÃªn báº£ng (Table)

### CÃ¡c kiá»ƒu sá»‘ liá»‡u
- text  
- binary  
- numeric  
- money  
- datetime  
- bit  
- variant  

### CÃ¡c rÃ ng buá»™c
- default  
- check  
- unique  
- foreign  
- primary  

### CÃ¡c kiá»ƒu toÃ n váº¹n
- entity  
- domain  
- referential  
- user  

### CÃ¡c thuá»™c tÃ­nh bá»• trá»£
- identity  
- null  

### CÃ¡c lá»‡nh cÆ¡ báº£n
- **Táº¡o báº£ng**
```sql
create table SinhVien (MaSV int, TenSV nchar(50))
```

- **Táº¡o báº£ng vá»›i rÃ ng buá»™c**
```sql
create table SinhVien (
  MaSV int primary key,
  TenSV nvarchar(50) not null,
  QueQuan int references DiaPhuong(MaDP)
)
```

- **XÃ³a báº£ng**
```sql
drop table SinhVien
```

- **ThÃªm cá»™t**
```sql
alter table SinhVien add QueQuan int
```

- **XÃ³a cá»™t**
```sql
alter table SinhVien drop column QueQuan
```

- **ThÃªm thuá»™c tÃ­nh not null**
```sql
alter table SinhVien alter column TenSV nchar(50) not null
```

- **ThÃªm khÃ³a chÃ­nh**
```sql
alter table SinhVien alter column MaSV int not null
go
alter table SinhVien add primary key (MaSV)
```

- **ThÃªm khÃ³a ngoáº¡i**
```sql
alter table SinhVien add foreign key (QueQuan) references DiaPhuong(MaDP)
```

- **ThÃªm máº·c Ä‘á»‹nh**
```sql
alter table SinhVien add default 'khong ten' for TenSV
```

- **Xem thÃ´ng tin báº£ng**
```sql
exec sp_help SinhVien
```

---

## 3) TrÃªn báº£n ghi (Record)

### CÃ¡c lá»‡nh cÆ¡ báº£n
- **ThÃªm báº£n ghi**
```sql
insert into SinhVien (MaSV, TenSV, QueQuan)
values (1, N'Nguyá»…n VÄƒn A', 1)
```

- **ThÃªm báº£n ghi tá»« báº£ng khÃ¡c**
```sql
insert into DocGia
select MaSV, TenSV, QueQuan from SinhVien
```

- **Select vÃ o báº£ng má»›i**
```sql
select MaSV, TenSV, Diem
into SinhVienKha
from SinhVien
where Diem > 7.0
```

- **XÃ³a báº£n ghi**
```sql
delete from SinhVien where MaSV=1234
```

- **XÃ³a toÃ n bá»™ báº£n ghi**
```sql
truncate table SinhVien
```

- **Cáº­p nháº­t báº£n ghi**
```sql
update SinhVien set NhomTruong = 1 where MaSV < 4
update SinhVien set NhomTruong = 4 where (MaSV > 3 and MaSV < 8)
```

---

## 4) Truy váº¥n (Query)

### Há»— trá»£ truy váº¥n
- distinct  
- top  
- as  
- identity  

### PhÃ©p toÃ¡n táº­p há»£p
- in  
- like  
- between  

### CÃ¡c hÃ m tá»•ng nhÃ³m
- sum  
- max  
- min  
- avg  

---

### 4.1 Truy váº¥n Ä‘Æ¡n giáº£n
- **Hiá»‡n táº¥t cáº£ báº£ng**
```sql
select * from SinhVien
```

- **Hiá»‡n má»™t sá»‘ cá»™t**
```sql
select TenSV, DiemTB from SinhVien
```

- **CÃ³ Ä‘iá»u kiá»‡n where**
```sql
select TenSV, DiemTB
from SinhVien
where DiemTB > 6.0
```

- **Sáº¯p xáº¿p**
```sql
select TenSV, DiemTB
from SinhVien
order by DiemTB desc, TenSV asc
```

- **Distinct**
```sql
select distinct QueQuan from SinhVien
```

- **Top**
```sql
select top 3 TenSV, DiemTB
from SinhVien
order by DiemTB desc, TenSV asc
```

---

### 4.2 Truy váº¥n lá»“ng nhau
- **Subquery trong where**
```sql
select TenNV, Luong
from NhanVien
where Luong = (select max(Luong) from NhanVien)
```

- **Sá»­ dá»¥ng in**
```sql
select TenNV, Luong
from NhanVien
where Luong in (select top 2 Luong from NhanVien order by Luong)
```

- **So sÃ¡nh theo phÃ²ng**
```sql
select nv1.TenNV, nv1.Luong
from NhanVien as nv1
where nv1.Luong = (
  select max(Luong)
  from NhanVien
  where Phong = nv1.Phong
)
```

---

### 4.3 Truy váº¥n tá»•ng nhÃ³m
![alt text](img/a-diagram-of-a-split-and-combine-description-auto.png)
- **Group by**
```sql
select QueQuan, count(*)
from NhanVien
group by QueQuan
```

- **Having**
```sql
select Phong, sum(Luong)
from NhanVien
group by Phong
having sum(Luong) > 5000000
```

---

### 4.4 Truy váº¥n liÃªn báº£ng (Join)
![alt text](img/491e498f-d2c2-4a49-b5be-1d3274c95f12.webp)
- **Inner join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
inner join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Left join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
left outer join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Right join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
right outer join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Full join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
full outer join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Cross join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
cross join DiaPhuong
```

---

## Tham kháº£o thÃªm

### Xem táº¥t cáº£ cÆ¡ sá»Ÿ dá»¯ liá»‡u
```sql
select * from master.dbo.sysdatabases where sid <> 1
```

### Xem táº¥t cáº£ báº£ng trong cÆ¡ sá»Ÿ dá»¯ liá»‡u
```sql
select * from Northwind.dbo.sysobjects where xtype='U'
```

### Xem táº¥t cáº£ cá»™t trong báº£ng
```sql
declare @x int
set @x = (select id from sysobjects where name='Employees')
select * from syscolumns where id = @x
```

### Báº£ng táº¡m
```sql
declare @x table(MaSV int, TenSV nvarchar(20))
insert into @x values(1, N'ThÆ°á»Ÿng')
insert into @x values(2, N'Yáº¿n')
select * from @x
```

### Biáº¿n táº¡m
```sql
declare @t money
set @t = (select max(UnitPrice) from Northwind.dbo.products)
select * from Northwind.dbo.products where UnitPrice >= @t
```

---

## CÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u

### CÃ¡c mÃ´ hÃ¬nh dá»¯ liá»‡u
- MÃ´ hÃ¬nh thá»© báº­c (Hierarchical)  
- MÃ´ hÃ¬nh máº¡ng lÆ°á»›i (Network)  
- MÃ´ hÃ¬nh quan há»‡ (Relational)  

### CÃ¡c váº¥n Ä‘á» cá»§a lÆ°u trá»¯
- Sá»± dÆ° thá»«a (Redundance)  
- Sá»± nháº¥t quÃ¡n (Consistence)  
- TÃ­nh toÃ n váº¹n (Integrity)  
- Sá»± an toÃ n (Security)  
- Sá»± chia sáº» (Sharing)  

### CÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n
- CÆ¡ sá»Ÿ dá»¯ liá»‡u (Database)  
- Báº£ng (Table) / Quan há»‡ (Relation)  
- Báº£n ghi (Record) / DÃ²ng (Row) / Bá»™ (Tuple)  
- TrÆ°á»ng (Field) / Cá»™t (Column)  
- Má»‘i quan há»‡ (Relationship)  

---

## Váº¥n Ä‘á» toÃ n váº¹n dá»¯ liá»‡u

### ToÃ n váº¹n dá»¯ liá»‡u
- **Thá»±c thá»ƒ (Entity integrity)**: primary key, unique, identity  
- **Tham chiáº¿u (Referential integrity)**: foreign key, check  
- **Miá»n dá»¯ liá»‡u (Domain integrity)**: default, foreign key, check, not null  
- **NgÆ°á»i dÃ¹ng (User integrity)**: rules, stored procedures, triggers  

### CÃ¡c há»— trá»£ toÃ n váº¹n
- Check constraint  
- Default constraint  
- Unique constraint  
- Foreign key constraint  
- Primary key constraint  
- Identity property  
- Not null property  

---

## CÃ¡c kiá»ƒu dá»¯ liá»‡u

- **GiÃ¡ trá»‹ nhá»‹ phÃ¢n**: bit  
- **Sá»‘ nguyÃªn**: bigint, int, smallint, tinyint  
- **Sá»‘ thá»±c xáº¥p xá»‰**: float, real  
- **Sá»‘ thá»±c chÃ­nh xÃ¡c**: decimal, numeric  
- **Tiá»n tá»‡**: money, smallmoney  
- **Thá»i gian**: datetime, smalldatetime  
- **Chuá»—i**: char, varchar, text, nchar, nvarchar, ntext  
- **Chuá»—i nhá»‹ phÃ¢n**: binary, varbinary, image  
- **Kiá»ƒu khÃ¡c**: cursor, table, variant, timestamp, uniqueidentifier  

---
# CÃ¡c thao tÃ¡c cÆ¡ báº£n: SELECT, INSERT, UPDATE, DELETE, tá»« khÃ³a AS, DISTINCT

## Lá»c dá»¯ liá»‡u: WHERE, HAVING

## Káº¿t há»£p báº£ng vÃ  káº¿t quáº£: JOIN, UNION

## Tá»•ng há»£p vÃ  nhÃ³m dá»¯ liá»‡u: COUNT, SUM, AVG, GROUP BY

## Truy váº¥n con: Subquery

## Thá»© tá»± thá»±c thi logic cá»§a truy váº¥n
# Thá»© Tá»± Thá»±c Thi Trong SQL (SQL Order of Execution)

**Thá»© tá»± thá»±c thi trong SQL** (SQL order of execution) lÃ  trÃ¬nh tá»± mÃ  cÃ¡c má»‡nh Ä‘á» khÃ¡c nhau trong má»™t truy váº¥n Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡. Äiá»u nÃ y Ä‘Ã¡ng Ä‘á»ƒ hiá»ƒu vÃ¬ thá»© tá»± thá»±c thi thÆ°á»ng **khÃ¡c** vá»›i cÃ¡ch chÃºng ta **viáº¿t** cÃ¢u lá»‡nh SQL. Láº¥y vÃ­ dá»¥ Ä‘Æ¡n giáº£n: báº¡n cÃ³ thá»ƒ nghÄ© ráº±ng vá»›i `SELECT * FROM database`, má»‡nh Ä‘á» `SELECT` Ä‘Æ°á»£c thá»±c thi trÆ°á»›c; nhÆ°ng thá»±c táº¿, thá»© tá»± thá»±c thi **báº¯t Ä‘áº§u** tá»« má»‡nh Ä‘á» `FROM`.

DÆ°á»›i Ä‘Ã¢y lÃ  **thá»© tá»± thá»±c thi** trong SQL. á»ž pháº§n tiáº¿p theo, chÃºng ta sáº½ Ä‘i chi tiáº¿t tá»«ng bÆ°á»›c.

* **FROM/JOIN:** Chá»‰ Ä‘á»‹nh báº£ng dá»¯ liá»‡u cáº§n truy xuáº¥t.
* **WHERE:** Lá»c cÃ¡c hÃ ng thá»a Ä‘iá»u kiá»‡n trÆ°á»›c khi nhÃ³m.
* **GROUP BY:** NhÃ³m cÃ¡c hÃ ng cÃ³ chung má»™t thuá»™c tÃ­nh.
* **HAVING:** Lá»c cÃ¡c nhÃ³m dá»±a trÃªn Ä‘iá»u kiá»‡n, Ã¡p dá»¥ng sau khi Ä‘Ã£ nhÃ³m.
* **SELECT:** Chá»‰ Ä‘á»‹nh cÃ¡c cá»™t cáº§n truy xuáº¥t hoáº·c tÃ­nh toÃ¡n.
* **DISTINCT:** Loáº¡i bá» cÃ¡c dÃ²ng trÃ¹ng láº·p khá»i táº­p káº¿t quáº£.
* **ORDER BY:** Sáº¯p xáº¿p táº­p káº¿t quáº£ theo cÃ¡c cá»™t chá»‰ Ä‘á»‹nh.
* **LIMIT:** Giá»›i háº¡n sá»‘ lÆ°á»£ng hÃ ng tráº£ vá» tá»‘i Ä‘a.
* **OFFSET:** Bá» qua má»™t sá»‘ lÆ°á»£ng hÃ ng trÆ°á»›c khi báº¯t Ä‘áº§u tráº£ vá» káº¿t quáº£.

Trong truy váº¥n sau, tÃ´i Ä‘Ã£ thÃªm chÃº thÃ­ch Ä‘á»ƒ chá»‰ ra má»‡nh Ä‘á» nÃ o Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ trÆ°á»›c.

```sql
-- #6+7   SELECT DISTINCT department_id                                 
-- #1     FROM employees                                                 
-- #2     JOIN orders ON customers.customer_id = orders.customer_id     
-- #3     WHERE salary > 3000                                          
-- #4     GROUP BY department 
-- #5     HAVING AVG(salary) > 5000 
-- #8     ORDER BY department 
-- #9     LIMIT 10 OFFSET 5 
-- #10    OFFSET 5 ROWS FETCH NEXT 10 ROWS ONLY; 
```

**Powered By**
TÃ´i cÅ©ng táº¡o má»™t cÃ¢u **acrostic** Ä‘á»ƒ dá»… nhá»›: *For Work Goals and Hurdles Search DataCamp's Organized Learning Opportunities.*

---

## CÃ¡c Giai Äoáº¡n Thá»±c Thi Truy Váº¥n SQL

Máº·c dÃ¹ háº§u háº¿t truy váº¥n SQL chÃºng ta viáº¿t **báº¯t Ä‘áº§u báº±ng** má»‡nh Ä‘á» `SELECT`, nhÆ°ng **thá»© tá»± thá»±c thi logic** báº¯t Ä‘áº§u vá»›i má»‡nh Ä‘á» `FROM`. á»ž Ä‘Ã¢y, tÃ´i sáº½ viáº¿t má»™t sá»‘ truy váº¥n Ä‘á»ƒ minh há»a thá»© tá»± thá»±c thi. LÆ°u Ã½: cÃ¡c truy váº¥n sau **chÆ°a Ä‘áº§y Ä‘á»§** nÃªn sáº½ **khÃ´ng** biÃªn dá»‹ch.

### Má»‡nh Ä‘á» FROM

Truy váº¥n SQL báº¯t Ä‘áº§u quÃ¡ trÃ¬nh thá»±c thi vá»›i má»‡nh Ä‘á» `FROM`. ÄÃ¢y thÆ°á»ng lÃ  giai Ä‘oáº¡n Ä‘áº§u tiÃªn vÃ¬ há»‡ quáº£n trá»‹ cÆ¡ sá»Ÿ dá»¯ liá»‡u xÃ¡c Ä‘á»‹nh **nguá»“n dá»¯ liá»‡u/báº£ng**. Khi cÃ³ nhiá»u báº£ng, truy váº¥n sáº½ Ä‘Ã¡nh giÃ¡ Ä‘iá»u kiá»‡n `JOIN` Ä‘á»ƒ káº¿t há»£p cÃ¡c báº£ng Ä‘Ã£ chá»‰ Ä‘á»‹nh lÃ m nguá»“n dá»¯ liá»‡u.

Truy váº¥n chÆ°a Ä‘áº§y Ä‘á»§ dÆ°á»›i Ä‘Ã¢y trÆ°á»›c háº¿t sáº½ chá»n dá»¯ liá»‡u tá»« báº£ng `customers` báº±ng `FROM`, vÃ  báº£ng `orders` báº±ng `JOIN`.

```sql
FROM customers
JOIN orders ON customers.customer_id = orders.customer_id;
```

**Powered By**

### Má»‡nh Ä‘á» WHERE

`WHERE` Ä‘Æ°á»£c thá»±c thi **sau** `FROM` vÃ  `JOIN` nháº±m lá»c cÃ¡c hÃ ng theo Ä‘iá»u kiá»‡n cá»¥ thá»ƒ. Quan trá»ng: **khÃ´ng thá»ƒ** tham chiáº¿u trá»±c tiáº¿p cÃ¡c **bÃ­ danh cá»™t** (alias) Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ `SELECT` trong `WHERE`, vÃ¬ `WHERE` Ä‘Æ°á»£c xá»­ lÃ½ **trÆ°á»›c** `SELECT`.

Truy váº¥n dÆ°á»›i Ä‘Ã¢y dÃ¹ng `WHERE` Ä‘á»ƒ lá»c cÃ¡c báº£n ghi nhÃ¢n viÃªn cÃ³ tiá»n thÆ°á»Ÿng lá»›n hÆ¡n 5000.

```sql
FROM employees
JOIN departments ON employees.employee_id = departments.department_id
WHERE salary * 0.1 > 5000;
```

**Powered By**

### Má»‡nh Ä‘á» GROUP BY

Sau khi lá»c hÃ ng, SQL thá»±c thi `GROUP BY` Ä‘á»ƒ nhÃ³m káº¿t quáº£ theo cÃ¡c cá»™t chá»‰ Ä‘á»‹nh. BÆ°á»›c nÃ y thÆ°á»ng dÃ¹ng vá»›i cÃ¡c hÃ m tá»•ng há»£p nhÆ° `COUNT()`, `SUM()`, `AVG()` Ä‘á»ƒ tÃ­nh toÃ¡n trÃªn cÃ¡c cá»™t.

Truy váº¥n dÆ°á»›i Ä‘Ã¢y trÆ°á»›c háº¿t lá»c nhÃ¢n viÃªn cÃ³ lÆ°Æ¡ng > 3.000, sau Ä‘Ã³ **nhÃ³m theo phÃ²ng ban** vÃ  tÃ­nh lÆ°Æ¡ng trung bÃ¬nh cho má»—i nhÃ³m.

```sql
FROM employees e
JOIN departments d ON e.employee_id = d.department_id
WHERE e.salary > 3000
GROUP BY e.name, d.department_name;
```

**Powered By**

### Má»‡nh Ä‘á» HAVING

`HAVING` giá»‘ng `WHERE` nhÆ°ng dÃ¹ng Ä‘á»ƒ **lá»c dá»¯ liá»‡u Ä‘Ã£ nhÃ³m** sau `GROUP BY`. Trong truy váº¥n dÆ°á»›i Ä‘Ã¢y, SQL nhÃ³m nhÃ¢n viÃªn theo phÃ²ng ban, tÃ­nh lÆ°Æ¡ng trung bÃ¬nh cho má»—i nhÃ³m, rá»“i loáº¡i cÃ¡c nhÃ³m cÃ³ lÆ°Æ¡ng trung bÃ¬nh â‰¤ 5.000.

```sql
FROM employees
JOIN departments ON employees.employee_id = departments.department_id
WHERE salary > 3000
GROUP BY department_name
HAVING AVG(salary) > 5000;
```

**Powered By**

### Má»‡nh Ä‘á» SELECT

`SELECT` lÃ  nÆ¡i SQL xÃ¡c Ä‘á»‹nh cÃ¡c cá»™t hoáº·c biá»ƒu thá»©c sáº½ tráº£ vá» sau khi cÃ¡c bÆ°á»›c trÆ°á»›c Ä‘Ã³ Ä‘Ã£ thá»±c thi. Báº¡n cÃ³ thá»ƒ Ã¡p dá»¥ng phÃ©p toÃ¡n, alias, vÃ  hÃ m tá»•ng há»£p trong `SELECT`.

Truy váº¥n sau láº¥y `name` vÃ  `bonus` (tÃ­nh báº±ng `salary * 0.1`) tá»« báº£ng `employees`.

```sql
SELECT name, salary * 0.1 AS bonus
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY name
HAVING AVG(salary) > 5000;
```

**Powered By**

### Má»‡nh Ä‘á» DISTINCT

`DISTINCT` Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ sau `SELECT`. NÃ³ há»¯u Ã­ch Ä‘á»ƒ loáº¡i bá» cÃ¡c báº£n ghi trÃ¹ng báº±ng cÃ¡ch tráº£ vá» cÃ¡c dÃ²ng **duy nháº¥t**. Truy váº¥n dÆ°á»›i Ä‘Ã¢y tráº£ vá» tá»«ng `department_id` duy nháº¥t, loáº¡i cÃ¡c giÃ¡ trá»‹ trÃ¹ng.

```sql
SELECT DISTINCT department_id
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY department
HAVING AVG(salary) > 5000;
```

**Powered By**

### Má»‡nh Ä‘á» ORDER BY

`ORDER BY` sáº¯p xáº¿p táº­p káº¿t quáº£ theo cÃ¡c cá»™t/biá»ƒu thá»©c. KhÃ´ng giá»‘ng `WHERE`, `ORDER BY` **cÃ³ thá»ƒ dÃ¹ng alias** Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong `SELECT`.

Truy váº¥n dÆ°á»›i Ä‘Ã¢y sáº¯p xáº¿p cá»™t `bonus` giáº£m dáº§n. LÆ°u Ã½ `bonus` lÃ  alias Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ `SELECT`.

```sql
SELECT DISTINCT department_id
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY department
HAVING AVG(salary) > 5000
ORDER BY bonus DESC;
```

**Powered By**

### Má»‡nh Ä‘á» LIMIT/OFFSET

`LIMIT` vÃ  `OFFSET` thÆ°á»ng lÃ  cÃ¡c bÆ°á»›c **cuá»‘i cÃ¹ng** nháº±m giá»›i háº¡n sá»‘ hÃ ng tráº£ vá». `LIMIT` Ä‘áº·t sá»‘ hÃ ng tá»‘i Ä‘a, cÃ²n `OFFSET` chá»‰ sá»‘ hÃ ng cáº§n **bá» qua** trÆ°á»›c khi báº¯t Ä‘áº§u tráº£ vá».

Truy váº¥n dÆ°á»›i Ä‘Ã¢y láº¥y tÃªn vÃ  lÆ°Æ¡ng nhÃ¢n viÃªn, sáº¯p xáº¿p theo lÆ°Æ¡ng giáº£m dáº§n, giá»›i háº¡n káº¿t quáº£ 10 dÃ²ng vÃ  bá» qua 5 dÃ²ng Ä‘áº§u tiÃªn.

```sql
SELECT DISTINCT department_id
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY department
HAVING AVG(salary) > 5000
ORDER BY bonus DESC
LIMIT 10 OFFSET 5;
-- OFFSET 5 ROWS FETCH NEXT 10 ROWS ONLY --SQL SERVER / ORACLE
```

**Powered By**
`LIMIT` vÃ  `OFFSET` Ä‘Æ°á»£c há»— trá»£ trong MySQL vÃ  PostgreSQL. Vá»›i SQL Server vÃ  Oracle, hÃ£y dÃ¹ng `OFFSET`, `ROWS FETCH`, vÃ  `ROWS ONLY` Ä‘á»ƒ giá»›i háº¡n sá»‘ hÃ ng tráº£ vá».

Xem thÃªm bÃ i hÆ°á»›ng dáº«n **How to Use SQL OFFSET** Ä‘á»ƒ tÃ¬m hiá»ƒu phÃ¢n trang dá»¯ liá»‡u vÃ  há»— trá»£ cá»¥ thá»ƒ theo tá»«ng há»‡ quáº£n trá»‹ (OFFSET, LIMIT).

---

## Thá»© Tá»± Thá»±c Thi vs. Thá»© Tá»± Viáº¿t Truy Váº¥n

SQL lÃ  ngÃ´n ngá»¯ **khai bÃ¡o** (declarative), nghÄ©a lÃ  **thá»© tá»± thá»±c thi** khÃ¡c **thá»© tá»± viáº¿t**. Thay vÃ¬ chá»‰ rÃµ cÃ¡ch thá»±c hiá»‡n tá»«ng bÆ°á»›c, báº¡n **mÃ´ táº£ Ä‘iá»u báº¡n muá»‘n**, cÃ²n há»‡ quáº£n trá»‹ CSDL quyáº¿t Ä‘á»‹nh cÃ¡ch tá»‘i Æ°u Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c. Äiá»u nÃ y khÃ¡c vá»›i cÃ¡c ngÃ´n ngá»¯ **má»‡nh lá»‡nh** (imperative) nhÆ° Python hoáº·c Java, nÆ¡i báº¡n viáº¿t tuáº§n tá»± cÃ¡c bÆ°á»›c thá»±c thi.

Hiá»ƒu thá»© tá»± thá»±c thi giÃºp báº¡n thay Ä‘á»•i cÃ¡ch tÆ° duy khi viáº¿t truy váº¥n. VÃ­ dá»¥, hÃ£y tÆ°á»Ÿng tÆ°á»£ng báº¡n viáº¿t truy váº¥n lá»c theo má»™t **alias** táº¡o á»Ÿ `SELECT`:

```sql
SELECT price * 0.9 AS discounted_price
FROM products
WHERE discounted_price > 100;
```

**Powered By**
NhÃ¬n qua thÃ¬ há»£p lÃ½, nhÆ°ng truy váº¥n nÃ y sáº½ **lá»—i**. Táº¡i sao? VÃ¬ `WHERE` Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ **trÆ°á»›c** `SELECT`. Äá»ƒ sá»­a, báº¡n cáº§n dÃ¹ng **subquery** hoáº·c `HAVING`:

```sql
SELECT price * 0.9 AS discounted_price
FROM products
HAVING discounted_price > 100;
```

**Powered By**
Äá»ƒ tÃ¬m hiá»ƒu thÃªm vá» `WHERE` vÃ  `HAVING`, hÃ£y xem bÃ i: **The Difference Between WHERE and HAVING in SQL**.

---

## Lá»—i Phá»• Biáº¿n & Thá»±c HÃ nh Tá»‘t

DÃ¹ thá»© tá»± viáº¿t khÃ´ng áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n thá»© tá»± thá»±c thi, hiá»ƒu **luá»“ng thá»±c thi** lÃ  chÃ¬a khÃ³a Ä‘á»ƒ trÃ¡nh lá»—i vÃ  cáº£i thiá»‡n hiá»‡u nÄƒng. CÃ¡c lá»—i sau thÆ°á»ng báº¯t nguá»“n tá»« viá»‡c hiá»ƒu sai thá»© tá»± thá»±c thi:

### CÃ¡c lá»—i thÆ°á»ng gáº·p

Nhá»¯ng lá»—i sau cÃ³ thá»ƒ lÃ m giáº£m hiá»‡u suáº¥t truy váº¥n cá»§a báº¡n:

* **DÃ¹ng alias cá»™t trong WHERE:** VÃ¬ `WHERE` cháº¡y **trÆ°á»›c** `SELECT`, dÃ¹ng alias trong `WHERE` sáº½ gÃ¢y lá»—i. HÃ£y láº·p láº¡i **biá»ƒu thá»©c Ä‘áº§y Ä‘á»§** thay vÃ¬ dá»±a vÃ o alias.
* **DÃ¹ng HAVING Ä‘á»ƒ lá»c tá»«ng hÃ ng thay cho WHERE:** `HAVING` cháº¡y **sau** `GROUP BY` vÃ  thiáº¿t káº¿ Ä‘á»ƒ lá»c **dá»¯ liá»‡u Ä‘Ã£ tá»•ng há»£p**. Náº¿u lá»c trÃªn dá»¯ liá»‡u **chÆ°a tá»•ng há»£p**, hÃ£y dÃ¹ng `WHERE`.
* **DÃ¹ng hÃ m tá»•ng há»£p trong SELECT mÃ  khÃ´ng cÃ³ GROUP BY:** VÃ¬ `GROUP BY` cháº¡y **trÆ°á»›c** `HAVING/SELECT`, khÃ´ng nhÃ³m dá»¯ liá»‡u trÆ°á»›c khi Ã¡p dá»¥ng hÃ m tá»•ng há»£p sáº½ táº¡o káº¿t quáº£ sai hoáº·c lá»—i.
* **KhÃ´ng dÃ¹ng alias Ä‘Ãºng cÃ¡ch trong ORDER BY:** KhÃ´ng nhÆ° `WHERE`, `ORDER BY` cháº¡y **sau** `SELECT`, nÃªn báº¡n **cÃ³ thá»ƒ** dÃ¹ng alias Ä‘á»ƒ sáº¯p xáº¿p. Biáº¿t thá»i Ä‘iá»ƒm alias kháº£ dá»¥ng giÃºp trÃ¡nh nháº§m láº«n.

DÆ°á»›i Ä‘Ã¢y lÃ  **cÃ¡c loáº¡i hÃ m trong SQL** (tá»•ng quÃ¡t, Ã¡p dá»¥ng cho MySQL/SQL Server/Postgres; tÃªn cá»¥ thá»ƒ cÃ³ thá»ƒ khÃ¡c Ä‘Ã´i chÃºt giá»¯a há»‡):

# 1) HÃ m tá»•ng há»£p (Aggregate)

Gá»™p **nhiá»u hÃ ng â†’ 1 giÃ¡ trá»‹** cho má»—i nhÃ³m.

* `COUNT(*)|col`, `SUM(col)`, `AVG(col)`, `MIN(col)`, `MAX(col)`
* MySQL: `GROUP_CONCAT(col SEPARATOR ',')`
* Postgres/SQL Server: `STRING_AGG(col, ',')`

```sql
SELECT customer_id, COUNT(*) AS order_count, SUM(total) AS revenue
FROM orders
GROUP BY customer_id
HAVING SUM(total) > 1000;
```

**LÆ°u Ã½:** `COUNT(col)` khÃ´ng Ä‘áº¿m `NULL`; `SUM/AVG` bá» qua `NULL`.

# 2) HÃ m cá»­a sá»• (Window / Analytic)

TÃ­nh trÃªn â€œcá»­a sá»•â€ hÃ ng cÃ³ liÃªn quan, **khÃ´ng** lÃ m máº¥t hÃ ng; cáº§n `OVER(...)`.

* So sÃ¡nh liÃªn hÃ ng: `LAG()`, `LEAD()`
* Xáº¿p háº¡ng: `ROW_NUMBER()`, `RANK()`, `DENSE_RANK()`, `NTILE()`
* Tá»•ng há»£p theo cá»­a sá»•: `SUM()/AVG()/... OVER(...)`

```sql
SELECT
  order_id, customer_id, total,
  SUM(total) OVER (PARTITION BY customer_id ORDER BY order_date) AS running_total
FROM orders;
```

> KhÃ´ng dÃ¹ng trá»±c tiáº¿p trong `WHERE`; bá»c subquery/CTE.

# 3) HÃ m vÃ´ hÆ°á»›ng / Ä‘Æ¡n trá»‹ (Scalar)

Ãp dá»¥ng **tá»«ng hÃ ng**, tráº£ vá» 1 giÃ¡ trá»‹.

* **Chuá»—i:** `LOWER/UPPER`, `TRIM`, `SUBSTRING`, `REPLACE`, `CONCAT`, `LEFT/RIGHT`, `LENGTH/CHAR_LENGTH`
* **Sá»‘:** `ABS`, `ROUND`, `CEIL/FLOOR`, `POWER`, `MOD`
* **NgÃ y giá»:**

  * MySQL: `NOW()`, `CURDATE()`, `DATE_ADD/SUB`, `DATEDIFF`, `TIMESTAMPDIFF`, `EXTRACT(...)`
  * SQL Server: `GETDATE()`, `DATEADD`, `DATEDIFF`, `DATEPART`, `FORMAT`
* **Äiá»u kiá»‡n:** `CASE WHEN ... THEN ... ELSE ... END`, `COALESCE`, `NULLIF`, (MySQL cÃ³ `IF(cond,a,b)`, SQL Server cÃ³ `ISNULL`)
* **Chuyá»ƒn kiá»ƒu:** `CAST(expr AS TYPE)`, `CONVERT(...)`

# 4) HÃ m táº­p há»£p tráº£ vá» báº£ng (Table-valued / Set-returning)

Tráº£ vá» **táº­p báº£n ghi** (phá»• biáº¿n á»Ÿ SQL Server/Postgres).

* SQL Server: **TVF** (Inline/Multistatement), `OPENJSON(...)`, `STRING_SPLIT(...)`
* Postgres: `unnest(...)`, `generate_series(...)`

```sql
-- SQL Server: tÃ¡ch chuá»—i thÃ nh báº£ng hÃ ng
SELECT value FROM STRING_SPLIT('a,b,c', ',');
```

# 5) HÃ m JSON / XML / bÃ¡n cáº¥u trÃºc

* MySQL: `JSON_EXTRACT`, `JSON_UNQUOTE`, `JSON_SET`, `JSON_ARRAYAGG`
* SQL Server: `JSON_VALUE`, `JSON_QUERY`, `OPENJSON`
* Postgres: `->`, `->>`, `jsonb_extract_path_text`, `jsonb_agg`

# 6) HÃ m khÃ´ng gian (Spatial / GIS)

* MySQL/SQL Server/Postgres: há» `ST_...` (vÃ­ dá»¥ `ST_Distance`, `ST_Contains`, `ST_AsText`)
* LÃ m viá»‡c vá»›i `POINT`, `POLYGON`, `GEOGRAPHY/GEOMETRY`.

# 7) HÃ m mÃ£ hoÃ¡/Hash & tiá»‡n Ã­ch há»‡ thá»‘ng

* Hash/mÃ£ hoÃ¡: `MD5`, `SHA1/SHA2`, `PGP_SYM_ENCRYPT` (Postgres extensions)
* Há»‡ thá»‘ng/phiÃªn báº£n/ngÆ°á»i dÃ¹ng: MySQL `VERSION()`, `USER()`, `DATABASE()`
* BÄƒm/uuid: Postgres `gen_random_uuid()`, SQL Server `NEWID()`

# 8) HÃ m do ngÆ°á»i dÃ¹ng Ä‘á»‹nh nghÄ©a (UDF)

* **Scalar UDF**: nháº­n tham sá»‘ â†’ tráº£ vá» 1 giÃ¡ trá»‹.
* **Table-valued function (TVF)**: tráº£ vá» báº£ng (SQL Server/Postgres).

> DÃ¹ng khi cáº§n tÃ¡i sá»­ dá»¥ng logic, nhÆ°ng chÃº Ã½ hiá»‡u nÄƒng/kháº£ nÄƒng tá»‘i Æ°u cá»§a bá»™ mÃ¡y SQL.

---

## Máº¹o thá»±c chiáº¿n

* **SARGable**: trÃ¡nh bá»c cá»™t báº±ng hÃ m trong `WHERE` náº¿u muá»‘n dÃ¹ng index (vÃ­ dá»¥, thay `WHERE DATE(order_date)=...` báº±ng `WHERE order_date >= ... AND order_date < ...`).
* **NULL**: hiá»ƒu rÃµ cÃ¡ch tá»«ng hÃ m xá»­ lÃ½ `NULL` Ä‘á»ƒ trÃ¡nh sai sá»‘.
* **Window vs Aggregate**: Window giá»¯ nguyÃªn sá»‘ hÃ ng; Aggregate rÃºt gá»n sá»‘ hÃ ng.
* **MySQL 5.7** khÃ´ng cÃ³ window functions â†’ cÃ¢n nháº¯c `JOIN`/biáº¿n user hoáº·c nÃ¢ng phiÃªn báº£n.

Náº¿u báº¡n cho mÃ¬nh DBMS báº¡n dÃ¹ng (MySQL hay SQL Server) + tÃ¡c vá»¥ cá»¥ thá»ƒ, mÃ¬nh sáº½ liá»‡t kÃª chÃ­nh xÃ¡c bá»™ hÃ m kÃ¨m snippet cho Ä‘Ãºng há»‡ Ä‘Ã³ nhÃ©.
