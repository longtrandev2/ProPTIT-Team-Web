- [\[BU·ªîI 3\] SQL c∆° b·∫£n](#bu·ªïi-3-sql-c∆°-b·∫£n)
- [üåà N·ªôi dung c·∫ßn chu·∫©n b·ªã.](#-n·ªôi-dung-c·∫ßn-chu·∫©n-b·ªã)
- [C√°c thao t√°c c∆° b·∫£n: SELECT, INSERT, UPDATE, DELETE, t·ª´ kh√≥a AS, DISTINCT](#c√°c-thao-t√°c-c∆°-b·∫£n-select-insert-update-delete-t·ª´-kh√≥a-as-distinct)
  - [L·ªçc d·ªØ li·ªáu: WHERE, HAVING](#l·ªçc-d·ªØ-li·ªáu-where-having)
  - [K·∫øt h·ª£p b·∫£ng v√† k·∫øt qu·∫£: JOIN, UNION](#k·∫øt-h·ª£p-b·∫£ng-v√†-k·∫øt-qu·∫£-join-union)
  - [T·ªïng h·ª£p v√† nh√≥m d·ªØ li·ªáu: COUNT, SUM, AVG, GROUP BY](#t·ªïng-h·ª£p-v√†-nh√≥m-d·ªØ-li·ªáu-count-sum-avg-group-by)
  - [Truy v·∫•n con: Subquery](#truy-v·∫•n-con-subquery)
  - [Th·ª© t·ª± th·ª±c thi logic c·ªßa truy v·∫•n](#th·ª©-t·ª±-th·ª±c-thi-logic-c·ªßa-truy-v·∫•n)
- [‚≠êÔ∏è B√†i t·∫≠p tr∆∞·ªõc bu·ªïi h·ªçc](#Ô∏è-b√†i-t·∫≠p-tr∆∞·ªõc-bu·ªïi-h·ªçc)
  - [Leetcode - 584](#leetcode---584)
  - [Leetcode - 1378](#leetcode---1378)
  - [Leetcode - 1141](#leetcode---1141)

# [BU·ªîI 3] SQL c∆° b·∫£n

# üåà N·ªôi dung c·∫ßn chu·∫©n b·ªã.
### C√°c l·ªánh c∆° b·∫£n
- **T·∫°o c∆° s·ªü d·ªØ li·ªáu**
```sql
create database HoSoSinhVien
on (name='HSSV_data', filename='c:HSSV_data.mdf')
log on (name='HSSV_log', filename='c:HSSV_log.ldf')
```

- **X√≥a c∆° s·ªü d·ªØ li·ªáu**
```sql
drop database HoSoSinhVien
```

- **S·ª≠a th√¥ng tin c∆° s·ªü d·ªØ li·ªáu**
```sql
alter database HoSoSinhVien
modify name = HSSV
```

- **S·ª≠ d·ª•ng sp_dboption**
```sql
exec sp_dboption HoSoSinhVien, 'read only', 'true'
exec sp_dboption HoSoSinhVien, 'autoshrink', 'true'
exec sp_dboption HoSoSinhVien, 'single_user'
```

- **DBCC**
```sql
dbcc shrinkdatabase(HoSoSinhVien, 10)
```

---

## 2) Tr√™n b·∫£ng (Table)

### C√°c ki·ªÉu s·ªë li·ªáu
- text  
- binary  
- numeric  
- money  
- datetime  
- bit  
- variant  

### C√°c r√†ng bu·ªôc
- default  
- check  
- unique  
- foreign  
- primary  

### C√°c ki·ªÉu to√†n v·∫πn
- entity  
- domain  
- referential  
- user  

### C√°c thu·ªôc t√≠nh b·ªï tr·ª£
- identity  
- null  

### C√°c l·ªánh c∆° b·∫£n
- **T·∫°o b·∫£ng**
```sql
create table SinhVien (MaSV int, TenSV nchar(50))
```

- **T·∫°o b·∫£ng v·ªõi r√†ng bu·ªôc**
```sql
create table SinhVien (
  MaSV int primary key,
  TenSV nvarchar(50) not null,
  QueQuan int references DiaPhuong(MaDP)
)
```

- **X√≥a b·∫£ng**
```sql
drop table SinhVien
```

- **Th√™m c·ªôt**
```sql
alter table SinhVien add QueQuan int
```

- **X√≥a c·ªôt**
```sql
alter table SinhVien drop column QueQuan
```

- **Th√™m thu·ªôc t√≠nh not null**
```sql
alter table SinhVien alter column TenSV nchar(50) not null
```

- **Th√™m kh√≥a ch√≠nh**
```sql
alter table SinhVien alter column MaSV int not null
go
alter table SinhVien add primary key (MaSV)
```

- **Th√™m kh√≥a ngo·∫°i**
```sql
alter table SinhVien add foreign key (QueQuan) references DiaPhuong(MaDP)
```

- **Th√™m m·∫∑c ƒë·ªãnh**
```sql
alter table SinhVien add default 'khong ten' for TenSV
```

- **Xem th√¥ng tin b·∫£ng**
```sql
exec sp_help SinhVien
```

---

## 3) Tr√™n b·∫£n ghi (Record)

### C√°c l·ªánh c∆° b·∫£n
- **Th√™m b·∫£n ghi**
```sql
insert into SinhVien (MaSV, TenSV, QueQuan)
values (1, N'Nguy·ªÖn VƒÉn A', 1)
```

- **Th√™m b·∫£n ghi t·ª´ b·∫£ng kh√°c**
```sql
insert into DocGia
select MaSV, TenSV, QueQuan from SinhVien
```

- **Select v√†o b·∫£ng m·ªõi**
```sql
select MaSV, TenSV, Diem
into SinhVienKha
from SinhVien
where Diem > 7.0
```

- **X√≥a b·∫£n ghi**
```sql
delete from SinhVien where MaSV=1234
```

- **X√≥a to√†n b·ªô b·∫£n ghi**
```sql
truncate table SinhVien
```

- **C·∫≠p nh·∫≠t b·∫£n ghi**
```sql
update SinhVien set NhomTruong = 1 where MaSV < 4
update SinhVien set NhomTruong = 4 where (MaSV > 3 and MaSV < 8)
```

---

## 4) Truy v·∫•n (Query)

### H·ªó tr·ª£ truy v·∫•n
- distinct  
- top  
- as  
- identity  

### Ph√©p to√°n t·∫≠p h·ª£p
- in  
- like  
- between  

### C√°c h√†m t·ªïng nh√≥m
- sum  
- max  
- min  
- avg  

---

### 4.1 Truy v·∫•n ƒë∆°n gi·∫£n
- **Hi·ªán t·∫•t c·∫£ b·∫£ng**
```sql
select * from SinhVien
```

- **Hi·ªán m·ªôt s·ªë c·ªôt**
```sql
select TenSV, DiemTB from SinhVien
```

- **C√≥ ƒëi·ªÅu ki·ªán where**
```sql
select TenSV, DiemTB
from SinhVien
where DiemTB > 6.0
```

- **S·∫Øp x·∫øp**
```sql
select TenSV, DiemTB
from SinhVien
order by DiemTB desc, TenSV asc
```

- **Distinct**
```sql
select distinct QueQuan from SinhVien
```

- **Top**
```sql
select top 3 TenSV, DiemTB
from SinhVien
order by DiemTB desc, TenSV asc
```

---

### 4.2 Truy v·∫•n l·ªìng nhau
- **Subquery trong where**
```sql
select TenNV, Luong
from NhanVien
where Luong = (select max(Luong) from NhanVien)
```

- **S·ª≠ d·ª•ng in**
```sql
select TenNV, Luong
from NhanVien
where Luong in (select top 2 Luong from NhanVien order by Luong)
```

- **So s√°nh theo ph√≤ng**
```sql
select nv1.TenNV, nv1.Luong
from NhanVien as nv1
where nv1.Luong = (
  select max(Luong)
  from NhanVien
  where Phong = nv1.Phong
)
```

---

### 4.3 Truy v·∫•n t·ªïng nh√≥m
![alt text](img/a-diagram-of-a-split-and-combine-description-auto.png)
- **Group by**
```sql
select QueQuan, count(*)
from NhanVien
group by QueQuan
```

- **Having**
```sql
select Phong, sum(Luong)
from NhanVien
group by Phong
having sum(Luong) > 5000000
```

---

### 4.4 Truy v·∫•n li√™n b·∫£ng (Join)
![alt text](img/491e498f-d2c2-4a49-b5be-1d3274c95f12.webp)
- **Inner join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
inner join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Left join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
left outer join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Right join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
right outer join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Full join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
full outer join DiaPhuong on NhanVien.QueQuan = DiaPhuong.MaDP
```

- **Cross join**
```sql
select NhanVien.TenNV, DiaPhuong.TenDP
from NhanVien
cross join DiaPhuong
```

---

## Tham kh·∫£o th√™m

### Xem t·∫•t c·∫£ c∆° s·ªü d·ªØ li·ªáu
```sql
select * from master.dbo.sysdatabases where sid <> 1
```

### Xem t·∫•t c·∫£ b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu
```sql
select * from Northwind.dbo.sysobjects where xtype='U'
```

### Xem t·∫•t c·∫£ c·ªôt trong b·∫£ng
```sql
declare @x int
set @x = (select id from sysobjects where name='Employees')
select * from syscolumns where id = @x
```

### B·∫£ng t·∫°m
```sql
declare @x table(MaSV int, TenSV nvarchar(20))
insert into @x values(1, N'Th∆∞·ªüng')
insert into @x values(2, N'Y·∫øn')
select * from @x
```

### Bi·∫øn t·∫°m
```sql
declare @t money
set @t = (select max(UnitPrice) from Northwind.dbo.products)
select * from Northwind.dbo.products where UnitPrice >= @t
```

---

## C√°c kh√°i ni·ªám c∆° b·∫£n c·ªßa c∆° s·ªü d·ªØ li·ªáu

### C√°c m√¥ h√¨nh d·ªØ li·ªáu
- M√¥ h√¨nh th·ª© b·∫≠c (Hierarchical)  
- M√¥ h√¨nh m·∫°ng l∆∞·ªõi (Network)  
- M√¥ h√¨nh quan h·ªá (Relational)  

### C√°c v·∫•n ƒë·ªÅ c·ªßa l∆∞u tr·ªØ
- S·ª± d∆∞ th·ª´a (Redundance)  
- S·ª± nh·∫•t qu√°n (Consistence)  
- T√≠nh to√†n v·∫πn (Integrity)  
- S·ª± an to√†n (Security)  
- S·ª± chia s·∫ª (Sharing)  

### C√°c kh√°i ni·ªám c∆° b·∫£n
- C∆° s·ªü d·ªØ li·ªáu (Database)  
- B·∫£ng (Table) / Quan h·ªá (Relation)  
- B·∫£n ghi (Record) / D√≤ng (Row) / B·ªô (Tuple)  
- Tr∆∞·ªùng (Field) / C·ªôt (Column)  
- M·ªëi quan h·ªá (Relationship)  

---

## V·∫•n ƒë·ªÅ to√†n v·∫πn d·ªØ li·ªáu

### To√†n v·∫πn d·ªØ li·ªáu
- **Th·ª±c th·ªÉ (Entity integrity)**: primary key, unique, identity  
- **Tham chi·∫øu (Referential integrity)**: foreign key, check  
- **Mi·ªÅn d·ªØ li·ªáu (Domain integrity)**: default, foreign key, check, not null  
- **Ng∆∞·ªùi d√πng (User integrity)**: rules, stored procedures, triggers  

### C√°c h·ªó tr·ª£ to√†n v·∫πn
- Check constraint  
- Default constraint  
- Unique constraint  
- Foreign key constraint  
- Primary key constraint  
- Identity property  
- Not null property  

---

## C√°c ki·ªÉu d·ªØ li·ªáu

- **Gi√° tr·ªã nh·ªã ph√¢n**: bit  
- **S·ªë nguy√™n**: bigint, int, smallint, tinyint  
- **S·ªë th·ª±c x·∫•p x·ªâ**: float, real  
- **S·ªë th·ª±c ch√≠nh x√°c**: decimal, numeric  
- **Ti·ªÅn t·ªá**: money, smallmoney  
- **Th·ªùi gian**: datetime, smalldatetime  
- **Chu·ªói**: char, varchar, text, nchar, nvarchar, ntext  
- **Chu·ªói nh·ªã ph√¢n**: binary, varbinary, image  
- **Ki·ªÉu kh√°c**: cursor, table, variant, timestamp, uniqueidentifier  

---
# C√°c thao t√°c c∆° b·∫£n: SELECT, INSERT, UPDATE, DELETE, t·ª´ kh√≥a AS, DISTINCT

## L·ªçc d·ªØ li·ªáu: WHERE, HAVING

## K·∫øt h·ª£p b·∫£ng v√† k·∫øt qu·∫£: JOIN, UNION

## T·ªïng h·ª£p v√† nh√≥m d·ªØ li·ªáu: COUNT, SUM, AVG, GROUP BY

## Truy v·∫•n con: Subquery

## Th·ª© t·ª± th·ª±c thi logic c·ªßa truy v·∫•n
# Th·ª© T·ª± Th·ª±c Thi Trong SQL (SQL Order of Execution)

**Th·ª© t·ª± th·ª±c thi trong SQL** (SQL order of execution) l√† tr√¨nh t·ª± m√† c√°c m·ªánh ƒë·ªÅ kh√°c nhau trong m·ªôt truy v·∫•n ƒë∆∞·ª£c ƒë√°nh gi√°. ƒêi·ªÅu n√†y ƒë√°ng ƒë·ªÉ hi·ªÉu v√¨ th·ª© t·ª± th·ª±c thi th∆∞·ªùng **kh√°c** v·ªõi c√°ch ch√∫ng ta **vi·∫øt** c√¢u l·ªánh SQL. L·∫•y v√≠ d·ª• ƒë∆°n gi·∫£n: b·∫°n c√≥ th·ªÉ nghƒ© r·∫±ng v·ªõi `SELECT * FROM database`, m·ªánh ƒë·ªÅ `SELECT` ƒë∆∞·ª£c th·ª±c thi tr∆∞·ªõc; nh∆∞ng th·ª±c t·∫ø, th·ª© t·ª± th·ª±c thi **b·∫Øt ƒë·∫ßu** t·ª´ m·ªánh ƒë·ªÅ `FROM`.

D∆∞·ªõi ƒë√¢y l√† **th·ª© t·ª± th·ª±c thi** trong SQL. ·ªû ph·∫ßn ti·∫øp theo, ch√∫ng ta s·∫Ω ƒëi chi ti·∫øt t·ª´ng b∆∞·ªõc.

* **FROM/JOIN:** Ch·ªâ ƒë·ªãnh b·∫£ng d·ªØ li·ªáu c·∫ßn truy xu·∫•t.
* **WHERE:** L·ªçc c√°c h√†ng th·ªèa ƒëi·ªÅu ki·ªán tr∆∞·ªõc khi nh√≥m.
* **GROUP BY:** Nh√≥m c√°c h√†ng c√≥ chung m·ªôt thu·ªôc t√≠nh.
* **HAVING:** L·ªçc c√°c nh√≥m d·ª±a tr√™n ƒëi·ªÅu ki·ªán, √°p d·ª•ng sau khi ƒë√£ nh√≥m.
* **SELECT:** Ch·ªâ ƒë·ªãnh c√°c c·ªôt c·∫ßn truy xu·∫•t ho·∫∑c t√≠nh to√°n.
* **DISTINCT:** Lo·∫°i b·ªè c√°c d√≤ng tr√πng l·∫∑p kh·ªèi t·∫≠p k·∫øt qu·∫£.
* **ORDER BY:** S·∫Øp x·∫øp t·∫≠p k·∫øt qu·∫£ theo c√°c c·ªôt ch·ªâ ƒë·ªãnh.
* **LIMIT:** Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng h√†ng tr·∫£ v·ªÅ t·ªëi ƒëa.
* **OFFSET:** B·ªè qua m·ªôt s·ªë l∆∞·ª£ng h√†ng tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu tr·∫£ v·ªÅ k·∫øt qu·∫£.

Trong truy v·∫•n sau, t√¥i ƒë√£ th√™m ch√∫ th√≠ch ƒë·ªÉ ch·ªâ ra m·ªánh ƒë·ªÅ n√†o ƒë∆∞·ª£c ƒë√°nh gi√° tr∆∞·ªõc.

```sql
-- #6+7   SELECT DISTINCT department_id                                 
-- #1     FROM employees                                                 
-- #2     JOIN orders ON customers.customer_id = orders.customer_id     
-- #3     WHERE salary > 3000                                          
-- #4     GROUP BY department 
-- #5     HAVING AVG(salary) > 5000 
-- #8     ORDER BY department 
-- #9     LIMIT 10 OFFSET 5 
-- #10    OFFSET 5 ROWS FETCH NEXT 10 ROWS ONLY; 
```

**Powered By**
T√¥i c≈©ng t·∫°o m·ªôt c√¢u **acrostic** ƒë·ªÉ d·ªÖ nh·ªõ: *For Work Goals and Hurdles Search DataCamp's Organized Learning Opportunities.*

---

## C√°c Giai ƒêo·∫°n Th·ª±c Thi Truy V·∫•n SQL

M·∫∑c d√π h·∫ßu h·∫øt truy v·∫•n SQL ch√∫ng ta vi·∫øt **b·∫Øt ƒë·∫ßu b·∫±ng** m·ªánh ƒë·ªÅ `SELECT`, nh∆∞ng **th·ª© t·ª± th·ª±c thi logic** b·∫Øt ƒë·∫ßu v·ªõi m·ªánh ƒë·ªÅ `FROM`. ·ªû ƒë√¢y, t√¥i s·∫Ω vi·∫øt m·ªôt s·ªë truy v·∫•n ƒë·ªÉ minh h·ªça th·ª© t·ª± th·ª±c thi. L∆∞u √Ω: c√°c truy v·∫•n sau **ch∆∞a ƒë·∫ßy ƒë·ªß** n√™n s·∫Ω **kh√¥ng** bi√™n d·ªãch.

### M·ªánh ƒë·ªÅ FROM

Truy v·∫•n SQL b·∫Øt ƒë·∫ßu qu√° tr√¨nh th·ª±c thi v·ªõi m·ªánh ƒë·ªÅ `FROM`. ƒê√¢y th∆∞·ªùng l√† giai ƒëo·∫°n ƒë·∫ßu ti√™n v√¨ h·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu x√°c ƒë·ªãnh **ngu·ªìn d·ªØ li·ªáu/b·∫£ng**. Khi c√≥ nhi·ªÅu b·∫£ng, truy v·∫•n s·∫Ω ƒë√°nh gi√° ƒëi·ªÅu ki·ªán `JOIN` ƒë·ªÉ k·∫øt h·ª£p c√°c b·∫£ng ƒë√£ ch·ªâ ƒë·ªãnh l√†m ngu·ªìn d·ªØ li·ªáu.

Truy v·∫•n ch∆∞a ƒë·∫ßy ƒë·ªß d∆∞·ªõi ƒë√¢y tr∆∞·ªõc h·∫øt s·∫Ω ch·ªçn d·ªØ li·ªáu t·ª´ b·∫£ng `customers` b·∫±ng `FROM`, v√† b·∫£ng `orders` b·∫±ng `JOIN`.

```sql
FROM customers
JOIN orders ON customers.customer_id = orders.customer_id;
```

**Powered By**

### M·ªánh ƒë·ªÅ WHERE

`WHERE` ƒë∆∞·ª£c th·ª±c thi **sau** `FROM` v√† `JOIN` nh·∫±m l·ªçc c√°c h√†ng theo ƒëi·ªÅu ki·ªán c·ª• th·ªÉ. Quan tr·ªçng: **kh√¥ng th·ªÉ** tham chi·∫øu tr·ª±c ti·∫øp c√°c **b√≠ danh c·ªôt** (alias) ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ·ªü `SELECT` trong `WHERE`, v√¨ `WHERE` ƒë∆∞·ª£c x·ª≠ l√Ω **tr∆∞·ªõc** `SELECT`.

Truy v·∫•n d∆∞·ªõi ƒë√¢y d√πng `WHERE` ƒë·ªÉ l·ªçc c√°c b·∫£n ghi nh√¢n vi√™n c√≥ ti·ªÅn th∆∞·ªüng l·ªõn h∆°n 5000.

```sql
FROM employees
JOIN departments ON employees.employee_id = departments.department_id
WHERE salary * 0.1 > 5000;
```

**Powered By**

### M·ªánh ƒë·ªÅ GROUP BY

Sau khi l·ªçc h√†ng, SQL th·ª±c thi `GROUP BY` ƒë·ªÉ nh√≥m k·∫øt qu·∫£ theo c√°c c·ªôt ch·ªâ ƒë·ªãnh. B∆∞·ªõc n√†y th∆∞·ªùng d√πng v·ªõi c√°c h√†m t·ªïng h·ª£p nh∆∞ `COUNT()`, `SUM()`, `AVG()` ƒë·ªÉ t√≠nh to√°n tr√™n c√°c c·ªôt.

Truy v·∫•n d∆∞·ªõi ƒë√¢y tr∆∞·ªõc h·∫øt l·ªçc nh√¢n vi√™n c√≥ l∆∞∆°ng > 3.000, sau ƒë√≥ **nh√≥m theo ph√≤ng ban** v√† t√≠nh l∆∞∆°ng trung b√¨nh cho m·ªói nh√≥m.

```sql
FROM employees e
JOIN departments d ON e.employee_id = d.department_id
WHERE e.salary > 3000
GROUP BY e.name, d.department_name;
```

**Powered By**

### M·ªánh ƒë·ªÅ HAVING

`HAVING` gi·ªëng `WHERE` nh∆∞ng d√πng ƒë·ªÉ **l·ªçc d·ªØ li·ªáu ƒë√£ nh√≥m** sau `GROUP BY`. Trong truy v·∫•n d∆∞·ªõi ƒë√¢y, SQL nh√≥m nh√¢n vi√™n theo ph√≤ng ban, t√≠nh l∆∞∆°ng trung b√¨nh cho m·ªói nh√≥m, r·ªìi lo·∫°i c√°c nh√≥m c√≥ l∆∞∆°ng trung b√¨nh ‚â§ 5.000.

```sql
FROM employees
JOIN departments ON employees.employee_id = departments.department_id
WHERE salary > 3000
GROUP BY department_name
HAVING AVG(salary) > 5000;
```

**Powered By**

### M·ªánh ƒë·ªÅ SELECT

`SELECT` l√† n∆°i SQL x√°c ƒë·ªãnh c√°c c·ªôt ho·∫∑c bi·ªÉu th·ª©c s·∫Ω tr·∫£ v·ªÅ sau khi c√°c b∆∞·ªõc tr∆∞·ªõc ƒë√≥ ƒë√£ th·ª±c thi. B·∫°n c√≥ th·ªÉ √°p d·ª•ng ph√©p to√°n, alias, v√† h√†m t·ªïng h·ª£p trong `SELECT`.

Truy v·∫•n sau l·∫•y `name` v√† `bonus` (t√≠nh b·∫±ng `salary * 0.1`) t·ª´ b·∫£ng `employees`.

```sql
SELECT name, salary * 0.1 AS bonus
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY name
HAVING AVG(salary) > 5000;
```

**Powered By**

### M·ªánh ƒë·ªÅ DISTINCT

`DISTINCT` ƒë∆∞·ª£c ƒë√°nh gi√° sau `SELECT`. N√≥ h·ªØu √≠ch ƒë·ªÉ lo·∫°i b·ªè c√°c b·∫£n ghi tr√πng b·∫±ng c√°ch tr·∫£ v·ªÅ c√°c d√≤ng **duy nh·∫•t**. Truy v·∫•n d∆∞·ªõi ƒë√¢y tr·∫£ v·ªÅ t·ª´ng `department_id` duy nh·∫•t, lo·∫°i c√°c gi√° tr·ªã tr√πng.

```sql
SELECT DISTINCT department_id
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY department
HAVING AVG(salary) > 5000;
```

**Powered By**

### M·ªánh ƒë·ªÅ ORDER BY

`ORDER BY` s·∫Øp x·∫øp t·∫≠p k·∫øt qu·∫£ theo c√°c c·ªôt/bi·ªÉu th·ª©c. Kh√¥ng gi·ªëng `WHERE`, `ORDER BY` **c√≥ th·ªÉ d√πng alias** ƒë√£ ƒë·ªãnh nghƒ©a trong `SELECT`.

Truy v·∫•n d∆∞·ªõi ƒë√¢y s·∫Øp x·∫øp c·ªôt `bonus` gi·∫£m d·∫ßn. L∆∞u √Ω `bonus` l√† alias ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ·ªü `SELECT`.

```sql
SELECT DISTINCT department_id
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY department
HAVING AVG(salary) > 5000
ORDER BY bonus DESC;
```

**Powered By**

### M·ªánh ƒë·ªÅ LIMIT/OFFSET

`LIMIT` v√† `OFFSET` th∆∞·ªùng l√† c√°c b∆∞·ªõc **cu·ªëi c√πng** nh·∫±m gi·ªõi h·∫°n s·ªë h√†ng tr·∫£ v·ªÅ. `LIMIT` ƒë·∫∑t s·ªë h√†ng t·ªëi ƒëa, c√≤n `OFFSET` ch·ªâ s·ªë h√†ng c·∫ßn **b·ªè qua** tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu tr·∫£ v·ªÅ.

Truy v·∫•n d∆∞·ªõi ƒë√¢y l·∫•y t√™n v√† l∆∞∆°ng nh√¢n vi√™n, s·∫Øp x·∫øp theo l∆∞∆°ng gi·∫£m d·∫ßn, gi·ªõi h·∫°n k·∫øt qu·∫£ 10 d√≤ng v√† b·ªè qua 5 d√≤ng ƒë·∫ßu ti√™n.

```sql
SELECT DISTINCT department_id
FROM employees
JOIN orders ON customers.customer_id = orders.customer_id
WHERE salary > 3000
GROUP BY department
HAVING AVG(salary) > 5000
ORDER BY bonus DESC
LIMIT 10 OFFSET 5;
-- OFFSET 5 ROWS FETCH NEXT 10 ROWS ONLY --SQL SERVER / ORACLE
```

**Powered By**
`LIMIT` v√† `OFFSET` ƒë∆∞·ª£c h·ªó tr·ª£ trong MySQL v√† PostgreSQL. V·ªõi SQL Server v√† Oracle, h√£y d√πng `OFFSET`, `ROWS FETCH`, v√† `ROWS ONLY` ƒë·ªÉ gi·ªõi h·∫°n s·ªë h√†ng tr·∫£ v·ªÅ.

Xem th√™m b√†i h∆∞·ªõng d·∫´n **How to Use SQL OFFSET** ƒë·ªÉ t√¨m hi·ªÉu ph√¢n trang d·ªØ li·ªáu v√† h·ªó tr·ª£ c·ª• th·ªÉ theo t·ª´ng h·ªá qu·∫£n tr·ªã (OFFSET, LIMIT).

---

## Th·ª© T·ª± Th·ª±c Thi vs. Th·ª© T·ª± Vi·∫øt Truy V·∫•n

SQL l√† ng√¥n ng·ªØ **khai b√°o** (declarative), nghƒ©a l√† **th·ª© t·ª± th·ª±c thi** kh√°c **th·ª© t·ª± vi·∫øt**. Thay v√¨ ch·ªâ r√µ c√°ch th·ª±c hi·ªán t·ª´ng b∆∞·ªõc, b·∫°n **m√¥ t·∫£ ƒëi·ªÅu b·∫°n mu·ªën**, c√≤n h·ªá qu·∫£n tr·ªã CSDL quy·∫øt ƒë·ªãnh c√°ch t·ªëi ∆∞u ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c. ƒêi·ªÅu n√†y kh√°c v·ªõi c√°c ng√¥n ng·ªØ **m·ªánh l·ªánh** (imperative) nh∆∞ Python ho·∫∑c Java, n∆°i b·∫°n vi·∫øt tu·∫ßn t·ª± c√°c b∆∞·ªõc th·ª±c thi.

Hi·ªÉu th·ª© t·ª± th·ª±c thi gi√∫p b·∫°n thay ƒë·ªïi c√°ch t∆∞ duy khi vi·∫øt truy v·∫•n. V√≠ d·ª•, h√£y t∆∞·ªüng t∆∞·ª£ng b·∫°n vi·∫øt truy v·∫•n l·ªçc theo m·ªôt **alias** t·∫°o ·ªü `SELECT`:

```sql
SELECT price * 0.9 AS discounted_price
FROM products
WHERE discounted_price > 100;
```

**Powered By**
Nh√¨n qua th√¨ h·ª£p l√Ω, nh∆∞ng truy v·∫•n n√†y s·∫Ω **l·ªói**. T·∫°i sao? V√¨ `WHERE` ƒë∆∞·ª£c ƒë√°nh gi√° **tr∆∞·ªõc** `SELECT`. ƒê·ªÉ s·ª≠a, b·∫°n c·∫ßn d√πng **subquery** ho·∫∑c `HAVING`:

```sql
SELECT price * 0.9 AS discounted_price
FROM products
HAVING discounted_price > 100;
```

**Powered By**
ƒê·ªÉ t√¨m hi·ªÉu th√™m v·ªÅ `WHERE` v√† `HAVING`, h√£y xem b√†i: **The Difference Between WHERE and HAVING in SQL**.

---

## L·ªói Ph·ªï Bi·∫øn & Th·ª±c H√†nh T·ªët

D√π th·ª© t·ª± vi·∫øt kh√¥ng ·∫£nh h∆∞·ªüng tr·ª±c ti·∫øp ƒë·∫øn th·ª© t·ª± th·ª±c thi, hi·ªÉu **lu·ªìng th·ª±c thi** l√† ch√¨a kh√≥a ƒë·ªÉ tr√°nh l·ªói v√† c·∫£i thi·ªán hi·ªáu nƒÉng. C√°c l·ªói sau th∆∞·ªùng b·∫Øt ngu·ªìn t·ª´ vi·ªác hi·ªÉu sai th·ª© t·ª± th·ª±c thi:

### C√°c l·ªói th∆∞·ªùng g·∫∑p

Nh·ªØng l·ªói sau c√≥ th·ªÉ l√†m gi·∫£m hi·ªáu su·∫•t truy v·∫•n c·ªßa b·∫°n:

* **D√πng alias c·ªôt trong WHERE:** V√¨ `WHERE` ch·∫°y **tr∆∞·ªõc** `SELECT`, d√πng alias trong `WHERE` s·∫Ω g√¢y l·ªói. H√£y l·∫∑p l·∫°i **bi·ªÉu th·ª©c ƒë·∫ßy ƒë·ªß** thay v√¨ d·ª±a v√†o alias.
* **D√πng HAVING ƒë·ªÉ l·ªçc t·ª´ng h√†ng thay cho WHERE:** `HAVING` ch·∫°y **sau** `GROUP BY` v√† thi·∫øt k·∫ø ƒë·ªÉ l·ªçc **d·ªØ li·ªáu ƒë√£ t·ªïng h·ª£p**. N·∫øu l·ªçc tr√™n d·ªØ li·ªáu **ch∆∞a t·ªïng h·ª£p**, h√£y d√πng `WHERE`.
* **D√πng h√†m t·ªïng h·ª£p trong SELECT m√† kh√¥ng c√≥ GROUP BY:** V√¨ `GROUP BY` ch·∫°y **tr∆∞·ªõc** `HAVING/SELECT`, kh√¥ng nh√≥m d·ªØ li·ªáu tr∆∞·ªõc khi √°p d·ª•ng h√†m t·ªïng h·ª£p s·∫Ω t·∫°o k·∫øt qu·∫£ sai ho·∫∑c l·ªói.
* **Kh√¥ng d√πng alias ƒë√∫ng c√°ch trong ORDER BY:** Kh√¥ng nh∆∞ `WHERE`, `ORDER BY` ch·∫°y **sau** `SELECT`, n√™n b·∫°n **c√≥ th·ªÉ** d√πng alias ƒë·ªÉ s·∫Øp x·∫øp. Bi·∫øt th·ªùi ƒëi·ªÉm alias kh·∫£ d·ª•ng gi√∫p tr√°nh nh·∫ßm l·∫´n.

D∆∞·ªõi ƒë√¢y l√† **c√°c lo·∫°i h√†m trong SQL** (t·ªïng qu√°t, √°p d·ª•ng cho MySQL/SQL Server/Postgres; t√™n c·ª• th·ªÉ c√≥ th·ªÉ kh√°c ƒë√¥i ch√∫t gi·ªØa h·ªá):

# 1) H√†m t·ªïng h·ª£p (Aggregate)

G·ªôp **nhi·ªÅu h√†ng ‚Üí 1 gi√° tr·ªã** cho m·ªói nh√≥m.

* `COUNT(*)|col`, `SUM(col)`, `AVG(col)`, `MIN(col)`, `MAX(col)`
* MySQL: `GROUP_CONCAT(col SEPARATOR ',')`
* Postgres/SQL Server: `STRING_AGG(col, ',')`

```sql
SELECT customer_id, COUNT(*) AS order_count, SUM(total) AS revenue
FROM orders
GROUP BY customer_id
HAVING SUM(total) > 1000;
```

**L∆∞u √Ω:** `COUNT(col)` kh√¥ng ƒë·∫øm `NULL`; `SUM/AVG` b·ªè qua `NULL`.

# 2) H√†m c·ª≠a s·ªï (Window / Analytic)

T√≠nh tr√™n ‚Äúc·ª≠a s·ªï‚Äù h√†ng c√≥ li√™n quan, **kh√¥ng** l√†m m·∫•t h√†ng; c·∫ßn `OVER(...)`.

* So s√°nh li√™n h√†ng: `LAG()`, `LEAD()`
* X·∫øp h·∫°ng: `ROW_NUMBER()`, `RANK()`, `DENSE_RANK()`, `NTILE()`
* T·ªïng h·ª£p theo c·ª≠a s·ªï: `SUM()/AVG()/... OVER(...)`

```sql
SELECT
  order_id, customer_id, total,
  SUM(total) OVER (PARTITION BY customer_id ORDER BY order_date) AS running_total
FROM orders;
```

> Kh√¥ng d√πng tr·ª±c ti·∫øp trong `WHERE`; b·ªçc subquery/CTE.

# 3) H√†m v√¥ h∆∞·ªõng / ƒë∆°n tr·ªã (Scalar)

√Åp d·ª•ng **t·ª´ng h√†ng**, tr·∫£ v·ªÅ 1 gi√° tr·ªã.

* **Chu·ªói:** `LOWER/UPPER`, `TRIM`, `SUBSTRING`, `REPLACE`, `CONCAT`, `LEFT/RIGHT`, `LENGTH/CHAR_LENGTH`
* **S·ªë:** `ABS`, `ROUND`, `CEIL/FLOOR`, `POWER`, `MOD`
* **Ng√†y gi·ªù:**

  * MySQL: `NOW()`, `CURDATE()`, `DATE_ADD/SUB`, `DATEDIFF`, `TIMESTAMPDIFF`, `EXTRACT(...)`
  * SQL Server: `GETDATE()`, `DATEADD`, `DATEDIFF`, `DATEPART`, `FORMAT`
* **ƒêi·ªÅu ki·ªán:** `CASE WHEN ... THEN ... ELSE ... END`, `COALESCE`, `NULLIF`, (MySQL c√≥ `IF(cond,a,b)`, SQL Server c√≥ `ISNULL`)
* **Chuy·ªÉn ki·ªÉu:** `CAST(expr AS TYPE)`, `CONVERT(...)`

# 4) H√†m t·∫≠p h·ª£p tr·∫£ v·ªÅ b·∫£ng (Table-valued / Set-returning)

Tr·∫£ v·ªÅ **t·∫≠p b·∫£n ghi** (ph·ªï bi·∫øn ·ªü SQL Server/Postgres).

* SQL Server: **TVF** (Inline/Multistatement), `OPENJSON(...)`, `STRING_SPLIT(...)`
* Postgres: `unnest(...)`, `generate_series(...)`

```sql
-- SQL Server: t√°ch chu·ªói th√†nh b·∫£ng h√†ng
SELECT value FROM STRING_SPLIT('a,b,c', ',');
```

# 5) H√†m JSON / XML / b√°n c·∫•u tr√∫c

* MySQL: `JSON_EXTRACT`, `JSON_UNQUOTE`, `JSON_SET`, `JSON_ARRAYAGG`
* SQL Server: `JSON_VALUE`, `JSON_QUERY`, `OPENJSON`
* Postgres: `->`, `->>`, `jsonb_extract_path_text`, `jsonb_agg`

# 6) H√†m kh√¥ng gian (Spatial / GIS)

* MySQL/SQL Server/Postgres: h·ªç `ST_...` (v√≠ d·ª• `ST_Distance`, `ST_Contains`, `ST_AsText`)
* L√†m vi·ªác v·ªõi `POINT`, `POLYGON`, `GEOGRAPHY/GEOMETRY`.

# 7) H√†m m√£ ho√°/Hash & ti·ªán √≠ch h·ªá th·ªëng

* Hash/m√£ ho√°: `MD5`, `SHA1/SHA2`, `PGP_SYM_ENCRYPT` (Postgres extensions)
* H·ªá th·ªëng/phi√™n b·∫£n/ng∆∞·ªùi d√πng: MySQL `VERSION()`, `USER()`, `DATABASE()`
* BƒÉm/uuid: Postgres `gen_random_uuid()`, SQL Server `NEWID()`

# 8) H√†m do ng∆∞·ªùi d√πng ƒë·ªãnh nghƒ©a (UDF)

* **Scalar UDF**: nh·∫≠n tham s·ªë ‚Üí tr·∫£ v·ªÅ 1 gi√° tr·ªã.
* **Table-valued function (TVF)**: tr·∫£ v·ªÅ b·∫£ng (SQL Server/Postgres).

> D√πng khi c·∫ßn t√°i s·ª≠ d·ª•ng logic, nh∆∞ng ch√∫ √Ω hi·ªáu nƒÉng/kh·∫£ nƒÉng t·ªëi ∆∞u c·ªßa b·ªô m√°y SQL.

---

## M·∫πo th·ª±c chi·∫øn

* **SARGable**: tr√°nh b·ªçc c·ªôt b·∫±ng h√†m trong `WHERE` n·∫øu mu·ªën d√πng index (v√≠ d·ª•, thay `WHERE DATE(order_date)=...` b·∫±ng `WHERE order_date >= ... AND order_date < ...`).
* **NULL**: hi·ªÉu r√µ c√°ch t·ª´ng h√†m x·ª≠ l√Ω `NULL` ƒë·ªÉ tr√°nh sai s·ªë.
* **Window vs Aggregate**: Window gi·ªØ nguy√™n s·ªë h√†ng; Aggregate r√∫t g·ªçn s·ªë h√†ng.
* **MySQL 5.7** kh√¥ng c√≥ window functions ‚Üí c√¢n nh·∫Øc `JOIN`/bi·∫øn user ho·∫∑c n√¢ng phi√™n b·∫£n.

N·∫øu b·∫°n cho m√¨nh DBMS b·∫°n d√πng (MySQL hay SQL Server) + t√°c v·ª• c·ª• th·ªÉ, m√¨nh s·∫Ω li·ªát k√™ ch√≠nh x√°c b·ªô h√†m k√®m snippet cho ƒë√∫ng h·ªá ƒë√≥ nh√©.
