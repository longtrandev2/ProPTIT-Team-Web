# Tri·ªÉn khai RestfullAPI trong Spring Boot
## 1.1. C·∫•u tr√∫c d·ª± √°n

Trong s∆° ƒë·ªì tr√™n ch√∫ng ta th·∫•y c√≥ c√°c th√†nh ph·∫ßn ch√≠nh l√† **controller**, **model**, **repository**, **service** ‚Äî ƒë√¢y c≈©ng l√† m√¥ h√¨nh c∆° b·∫£n m√† ch√∫ng ta s·∫Ω th·∫•y r·∫•t nhi·ªÅu trong c√°c d·ª± √°n sau n√†y. D∆∞·ªõi ƒë√¢y ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ t·ª´ng th√†nh ph·∫ßn trong m√¥ h√¨nh tr√™n.

![alt text](img/structfolder.png)


## 1.2. C√†i ƒë·∫∑t th∆∞ vi·ªán

ƒê·∫ßu ti√™n ƒë·ªÉ chu·∫©n b·ªã cho vi·ªác kh·ªüi t·∫°o d·ª± √°n ch√∫ng ta c·∫ßn ph·∫£i th√™m m·ªôt s·ªë th∆∞ vi·ªán c·∫ßn thi·∫øt v√†o `pom.xml`:

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <optional>true</optional>
</dependency>
```



## 1.3. Controller

**Ch·ª©c nƒÉng:** Controller l√† m·ªôt ph·∫ßn quan tr·ªçng c·ªßa ·ª©ng d·ª•ng RESTful API, n√≥ nh·∫≠n v√† x·ª≠ l√Ω c√°c y√™u c·∫ßu HTTP t·ª´ c√°c client (th∆∞·ªùng l√† tr√¨nh duy·ªát ho·∫∑c ·ª©ng d·ª•ng di ƒë·ªông) v√† tr·∫£ v·ªÅ c√°c ph·∫£n h·ªìi th√≠ch h·ª£p.

**C√°ch s·ª≠ d·ª•ng:** B·∫°n ƒë√°nh d·∫•u c√°c l·ªõp v·ªõi `@RestController` ho·∫∑c c√°c ch√∫ th√≠ch t∆∞∆°ng t·ª± ƒë·ªÉ ch·ªâ ƒë·ªãnh r·∫±ng ƒë√¢y l√† c√°c controller. C√°c ph∆∞∆°ng th·ª©c b√™n trong controller ƒë∆∞·ª£c ƒë√°nh d·∫•u v·ªõi c√°c ch√∫ th√≠ch nh∆∞ `@GetMapping`, `@PostMapping`, `@PutMapping`, v√† `@DeleteMapping` ƒë·ªÉ x√°c ƒë·ªãnh c√°c endpoint API v√† x·ª≠ l√Ω c√°c y√™u c·∫ßu t·ª´ client.

**CategoryController.java**

```java
@RestController
@RequestMapping("v1/category")
public class CategoryController {

    @Autowired
    private CategoryService categoryService;

    @GetMapping("{id}")
    public ResponseEntity<Category> findCategory(@PathVariable Integer id) {
        Optional<Category> categoryOptional = categoryService.findCategory(id);
        return categoryOptional.map(ResponseEntity::ok)
                .orElseGet(() -> new ResponseEntity<>(HttpStatus.NOT_FOUND));
    }

    @GetMapping
    public ResponseEntity<List<Category>> findAll() {
        return ResponseEntity.ok(categoryService.findAll());
    }

    @PostMapping
    public ResponseEntity<Category> save(@RequestBody Category category) {
        return ResponseEntity.ok(categoryService.save(category));
    }

    @PutMapping
    public ResponseEntity<Category> update(@RequestBody Category category) {
        return ResponseEntity.ok(categoryService.update(category));
    }

    @DeleteMapping
    public void delete(@RequestBody Category category) {
         categoryService.delete(category);
    }
}
```



## 1.4. Model

**Ch·ª©c nƒÉng:** Model ƒë·∫°i di·ªán cho d·ªØ li·ªáu ho·∫∑c ƒë·ªëi t∆∞·ª£ng m√† b·∫°n mu·ªën truy c·∫≠p hay cung c·∫•p th√¥ng qua API. N√≥ ƒë·ªãnh nghƒ©a c·∫•u tr√∫c d·ªØ li·ªáu v√† c√°c tr∆∞·ªùng c·ªßa ƒë·ªëi t∆∞·ª£ng.

**C√°ch s·ª≠ d·ª•ng:** B·∫°n t·∫°o c√°c l·ªõp model ƒë·ªÉ m√¥ t·∫£ c·∫•u tr√∫c d·ªØ li·ªáu v√† th√¥ng tin v·ªÅ c√°c ƒë·ªëi t∆∞·ª£ng m√† b·∫°n s·∫Ω thao t√°c v·ªõi trong ·ª©ng d·ª•ng. ƒê·ªëi t∆∞·ª£ng model n√†y th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng trong c√°c ph∆∞∆°ng th·ª©c c·ªßa Controller v√† Repository ƒë·ªÉ thao t√°c v·ªõi d·ªØ li·ªáu.

**Category.java**

```java
@Entity
@Table(name = "category")
@Getter @Setter
public class Category {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Integer id;

    @Column(name = "name")
    private String name;

    @Column(name = "slug")
    private String slug;
}
```



## 1.5. Repository

**Ch·ª©c nƒÉng:** Repository l√†m nhi·ªám v·ª• truy c·∫≠p v√† t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu. N√≥ cung c·∫•p c√°c ph∆∞∆°ng th·ª©c ƒë·ªÉ l∆∞u tr·ªØ v√† truy v·∫•n d·ªØ li·ªáu t·ª´ c∆° s·ªü d·ªØ li·ªáu.

**C√°ch s·ª≠ d·ª•ng:** B·∫°n t·∫°o c√°c interface ho·∫∑c l·ªõp repository v·ªõi c√°c ph∆∞∆°ng th·ª©c ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c CRUD (Create, Read, Update, Delete) v·ªõi ƒë·ªëi t∆∞·ª£ng model. Spring Boot th∆∞·ªùng t√≠ch h·ª£p Spring Data JPA ƒë·ªÉ gi√∫p b·∫°n t·∫°o repository m·ªôt c√°ch d·ªÖ d√†ng.

**CategoryRepository.java**

```java
@Repository
public interface CategoryRepository extends JpaRepository<Category, Integer> {
}
```



## 1.6. Service

**Ch·ª©c nƒÉng:** Service l√†m nhi·ªám v·ª• k·∫øt n·ªëi gi·ªØa Controller v√† Repository. N√≥ ch·ª©a logic kinh doanh, ki·ªÉm tra quy·ªÅn truy c·∫≠p, x·ª≠ l√Ω nghi·ªáp v·ª• v√† g·ªçi c√°c ph∆∞∆°ng th·ª©c t·ª´ Repository ƒë·ªÉ truy c·∫≠p ho·∫∑c c·∫≠p nh·∫≠t d·ªØ li·ªáu.

**C√°ch s·ª≠ d·ª•ng:** B·∫°n t·∫°o c√°c l·ªõp service ƒë·ªÉ x·ª≠ l√Ω logic nghi·ªáp v·ª•. C√°c controller g·ªçi c√°c ph∆∞∆°ng th·ª©c t·ª´ service ƒë·ªÉ th·ª±c hi·ªán c√°c t√°c v·ª• nghi·ªáp v·ª•. ƒêi·ªÅu n√†y gi√∫p t√°ch bi·ªát logic nghi·ªáp v·ª• v√† logic truy c·∫≠p d·ªØ li·ªáu, l√†m cho m√£ ngu·ªìn d·ªÖ qu·∫£n l√Ω v√† b·∫£o tr√¨.

**CategoryService.java**

```java
public interface CategoryService {
    Optional<Category> findCategory(Integer id);
    List<Category> findAll();
    Category save(Category category);
    Category update(Category category);
    void delete(Category category);
}
```

**CategoryServiceImpl.java**

```java
@Service
public class CategoryServiceImpl implements CategoryService {

    @Autowired
    private CategoryRepository categoryRepository;

    @Override
    public Category save(Category category) {
        return categoryRepository.save(category);
    }

    @Override
    public Optional<Category> findCategory(Integer id) {
        return categoryRepository.findById(id);
    }

    @Override
    public List<Category> findAll() {
        return categoryRepository.findAll();
    }

    @Override
    public Category update(Category category) {
        return categoryRepository.save(category);
    }

    @Override
    public void delete(Category category) {
       categoryRepository.delete(category);
    }
}
```


# JPA l√† g√¨? Hibernate l√† g√¨?
## 1.JPA
### 1.1 JPA l√† g√¨?
JPA (vi·∫øt t·∫Øt c·ªßa Java Persistence API) l√† m·ªôt ti√™u chu·∫©n k·ªπ thu·∫≠t trong lƒ©nh v·ª±c ph√°t tri·ªÉn ·ª©ng d·ª•ng Java ƒë·ªÉ l·∫≠p tr√¨nh ƒë·ªëi t∆∞·ª£ng quan h·ªá (ORM). JPA ƒë∆∞·ª£c cung c·∫•p b·ªüi Oracle v√† ƒë√£ ƒë∆∞·ª£c th·ª´a nh·∫≠n l√† m·ªôt ti√™u chu·∫©n qu·ªëc t·∫ø.

JPA cung c·∫•p c√°ch ti·∫øp c·∫≠n tr·ª´u t∆∞·ª£ng cho vi·ªác l∆∞u tr·ªØ v√† truy xu·∫•t d·ªØ li·ªáu trong c∆° s·ªü d·ªØ li·ªáu quan h·ªá. S·ª≠ d·ª•ng JPA, ch√∫ng ta c√≥ th·ªÉ t·∫≠p trung v√†o thi·∫øt k·∫ø ·ª©ng d·ª•ng c·ªßa m√¨nh h∆°n l√† ph·∫£i lo v·ªÅ c√°ch l∆∞u tr·ªØ v√† truy xu·∫•t d·ªØ li·ªáu nh∆∞ th·∫ø n√†o.
### 1.2 S·ª± c·∫ßn thi·∫øt c·ªßa JPA trong ·ª©ng d·ª•ng Java
Trong qu√° tr√¨nh ph√°t tri·ªÉn ·ª©ng d·ª•ng Java, ch√∫ng ta kh√¥ng th·ªÉ tr√°nh kh·ªèi vi·ªác t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu. V·∫•n ƒë·ªÅ l√†, l√†m th·∫ø n√†o ƒë·ªÉ l∆∞u tr·ªØ v√† truy xu·∫•t d·ªØ li·ªáu m·ªôt c√°ch d·ªÖ d√†ng v√† hi·ªáu qu·∫£?

M·ªôt gi·∫£i ph√°p l√† s·ª≠ d·ª•ng **JDBC (Java Database Connectivity)**, m·ªôt API ƒë∆∞·ª£c cung c·∫•p b·ªüi Sun Microsystems ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu. Tuy nhi√™n, v·ªõi JDBC, ch√∫ng ta c·∫ßn ph·∫£i vi·∫øt r·∫•t nhi·ªÅu code ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông ƒë∆°n gi·∫£n nh∆∞ vi·ªác l·∫•y v√† c·∫≠p nh·∫≠t d·ªØ li·ªáu. ƒêi·ªÅu n√†y c√≥ th·ªÉ l√†m cho ·ª©ng d·ª•ng c·ªßa ch√∫ng ta tr·ªü n√™n ph·ª©c t·∫°p v√† kh√≥ b·∫£o tr√¨.

V√¨ v·∫≠y, JPA ra ƒë·ªùi nh·∫±m gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y b·∫±ng c√°ch gi·∫£m b·ªõt s·ª± ph·ª©c t·∫°p c·ªßa vi·ªác t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu. V·ªõi JPA, ta c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªëi t∆∞·ª£ng Java ƒë·ªÉ l∆∞u tr·ªØ v√† truy xu·∫•t d·ªØ li·ªáu. H∆°n n·ªØa, JPA s·∫Ω t·ª± ƒë·ªông chuy·ªÉn ƒë·ªïi c√°c ƒë·ªëi t∆∞·ª£ng th√†nh c√°c c√¢u truy v·∫•n SQL ƒë·ªÉ th·ª±c hi·ªán vi·ªác l∆∞u tr·ªØ v√† truy xu·∫•t, gi√∫p l·∫≠p tr√¨nh vi√™n ch√∫ng ta t·∫≠p trung v√†o vi·ªác ph√°t tri·ªÉn t√≠nh nƒÉng c·ªßa ·ª©ng d·ª•ng m√† kh√¥ng ph·∫£i lo nhi·ªÅu v·ªÅ SQL ph·ª©c t·∫°p.
### 1.3 Vai tr√≤ c·ªßa JPA trong ph√°t tri·ªÉn ·ª©ng d·ª•ng
JPA l√† m·ªôt c√¥ng ngh·ªá quan tr·ªçng trong vi·ªác ph√°t tri·ªÉn ·ª©ng d·ª•ng Java, b·ªüi v√¨ n√≥ gi√∫p:

- **Vi·∫øt code √≠t h∆°n**: S·ª≠ d·ª•ng JPA, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c ƒë·ªëi t∆∞·ª£ng Java thay v√¨ ph·∫£i vi·∫øt c√°c c√¢u truy v·∫•n SQL ho·∫∑c s·ª≠ d·ª•ng JDBC tr·ª±c ti·∫øp. ƒêi·ªÅu n√†y l√†m cho code tr·ªü n√™n ng·∫Øn g·ªçn h∆°n v√† d·ªÖ ƒë·ªçc h∆°n, gi·∫£m thi·ªÉu t·ªëi ƒëa boilerplate code.
- **D·ªÖ b·∫£o tr√¨**: V·ªõi JPA, vi·ªác thay ƒë·ªïi c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu tr·ªü n√™n d·ªÖ d√†ng h∆°n. Ch√∫ng ta ch·ªâ c·∫ßn thay ƒë·ªïi ƒë·ªãnh nghƒ©a c·ªßa ƒë·ªëi t∆∞·ª£ng Java v√† JPA s·∫Ω t·ª± ƒë·ªông √°p d·ª•ng c√°c thay ƒë·ªïi n√†y v√†o c∆° s·ªü d·ªØ li·ªáu t∆∞∆°ng ·ª©ng.
- **Hi·ªáu su·∫•t cao**: JPA gi√∫p t·ªëi ∆∞u h√≥a vi·ªác truy xu·∫•t v√† l∆∞u tr·ªØ d·ªØ li·ªáu trong c∆° s·ªü d·ªØ li·ªáu. N√≥ s·ª≠ d·ª•ng c√°c k·ªπ thu·∫≠t nh∆∞ lazy loading v√† caching ƒë·ªÉ gi·∫£m thi·ªÉu s·ªë l·∫ßn truy c·∫≠p v√†o c∆° s·ªü d·ªØ li·ªáu.
## 2. ORM l√† g√¨
### 2.1 M·ªôt s·ªë ORM framework h·ªó tr·ª£ JPA
**ORM (Object-Relational Mapping)** l√† m·ªôt k·ªπ thu·∫≠t trong l·∫≠p tr√¨nh ƒë·ªÉ √°nh x·∫° c√°c ƒë·ªëi t∆∞·ª£ng Java v√†o c∆° s·ªü d·ªØ li·ªáu quan h·ªá. Khi s·ª≠ d·ª•ng ORM, ch√∫ng ta c√≥ th·ªÉ l√†m vi·ªác v·ªõi c∆° s·ªü d·ªØ li·ªáu th√¥ng qua c√°c ƒë·ªëi t∆∞·ª£ng Java, thay v√¨ ph·∫£i s·ª≠ d·ª•ng c√°c c√¢u truy v·∫•n SQL tr·ª±c ti·∫øp.
![alt text](img/ORM.png)
C√≥ nhi·ªÅu framework h·ªó tr·ª£ ORM v√† JPA ƒë∆∞·ª£c li·ªát k√™ ph√≠a d∆∞·ªõi:

- **Hibernate**: Hibernate l√† m·ªôt trong nh·ªØng framework ORM ph·ªï bi·∫øn nh·∫•t v√† c≈©ng l√† backend m·∫∑c ƒë·ªãnh cho JPA. N√≥ cung c·∫•p c√°c t√≠nh nƒÉng m·∫°nh m·∫Ω v√† linh ho·∫°t cho vi·ªác t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu quan h·ªá.
- **EclipseLink**: EclipseLink l√† m·ªôt framework ORM m·∫°nh m·∫Ω kh√°c ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i trong c·ªông ƒë·ªìng Java. N√≥ c≈©ng h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß JPA.
- **OpenJPA**: OpenJPA l√† m·ªôt framework ORM ƒë∆∞·ª£c ph√°t tri·ªÉn b·ªüi Apache. N√≥ cung c·∫•p m·ªôt lo·∫°t c√°c t√≠nh nƒÉng ƒë·ªÉ l√†m vi·ªác v·ªõi c∆° s·ªü d·ªØ li·ªáu quan h·ªá v√† h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß JPA.
## 3. Java Persistence API c∆° b·∫£n
### 3.1 Ki·∫øn tr√∫c JPA

ƒê·ªÉ hi·ªÉu r√µ c√°ch JPA ho·∫°t ƒë·ªông, ch√∫ng ta c·∫ßn t√¨m hi·ªÉu v·ªÅ m·ªôt s·ªë th√†nh ph·∫ßn ch√≠nh c·ªßa n√≥.

### C√°c th√†nh ph·∫ßn c∆° b·∫£n trong JPA

#### 3.1.1 ƒê·ªãnh nghƒ©a Entity

Trong JPA, m·ªôt **Entity** l√† m·ªôt ƒë·ªëi t∆∞·ª£ng Java √°nh x·∫° v√†o m·ªôt b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu. Ch√∫ng ta c√≥ th·ªÉ hi·ªÉu l√† m·ªëi quan h·ªá 1-1. ƒê·ªëi t∆∞·ª£ng Entity ch·ª©a th√¥ng tin v·ªÅ c·∫•u tr√∫c v√† d·ªØ li·ªáu c·ªßa b·∫£ng.

ƒê·ªÉ ƒë·ªãnh nghƒ©a m·ªôt Entity trong JPA, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c annotation nh∆∞ `@Entity`, `@Table`, `@Column`, vv.

#### V√≠ d·ª•

```java
@Entity
@Table(name = "employees")
public class Employee {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "name")
    private String name;
    
    // getters and setters
}
```

·ªû v√≠ d·ª• tr√™n, `Employee` ƒë∆∞·ª£c ƒë√°nh d·∫•u l√† m·ªôt Entity b·∫±ng c√°ch s·ª≠ d·ª•ng annotation `@Entity`.
S·∫Ω √°nh x·∫° v√†o b·∫£ng `"employees"` trong c∆° s·ªü d·ªØ li·ªáu.
Thu·ªôc t√≠nh `id` ƒë∆∞·ª£c ƒë√°nh d·∫•u l√† kh√≥a ch√≠nh b·∫±ng c√°ch s·ª≠ d·ª•ng annotation `@Id`.
C√°c thu·ªôc t√≠nh kh√°c ƒë∆∞·ª£c √°nh x·∫° v√†o c√°c c·ªôt c·ªßa b·∫£ng b·∫±ng c√°ch s·ª≠ d·ª•ng annotation `@Column`.

### 3.1.2 Qu·∫£n l√Ω Entity Manager

**Entity Manager** l√† m·ªôt th√†nh ph·∫ßn quan tr·ªçng trong JPA.
N√≥ l√†m nhi·ªám v·ª• qu·∫£n l√Ω c√°c ƒë·ªëi t∆∞·ª£ng Entity v√† t·ª´ ƒë√≥ ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng Entity Manager ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông CRUD (Create, Read, Update, Delete) tr√™n c∆° s·ªü d·ªØ li·ªáu.

#### V√≠ d·ª•

```java
public void createEmployee(Employee employee) {
    EntityManager entityManager = // l·∫•y Entity Manager t·ª´ EntityManagerFactory
    
    entityManager.persist(employee); // th√™m ƒë·ªëi t∆∞·ª£ng v√†o c∆° s·ªü d·ªØ li·ªáu
}
```

Trong v√≠ d·ª• tr√™n, ch√∫ng ta s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `persist()` c·ªßa **Entity Manager** ƒë·ªÉ th√™m m·ªôt ƒë·ªëi t∆∞·ª£ng `Employee` v√†o c∆° s·ªü d·ªØ li·ªáu.



### 3.1.3 Entity Transaction

Trong JPA, m·ªói ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th·ª±c hi·ªán trong m·ªôt **transaction**.
Transaction l√† m·ªôt t·∫≠p h·ª£p c√°c ho·∫°t ƒë·ªông ghi v√† ƒë·ªçc d·ªØ li·ªáu li√™n quan m√† th∆∞·ªùng ƒë∆∞·ª£c th·ª±c hi·ªán c√πng nhau v√† ƒë∆∞·ª£c xem nh∆∞ l√† m·ªôt thao t√°c duy nh·∫•t.
Vi·ªác s·ª≠ d·ª•ng c√°c thao t√°c li√™n quan trong c√πng m·ªôt Transaction s·∫Ω gi√∫p ƒë·∫£m b·∫£o **t√≠nh to√†n v·∫πn c·ªßa d·ªØ li·ªáu** khi th·ª±c hi·ªán.

#### V√≠ d·ª•

```java
public void updateEmployeeName(long id, String newName) {
    EntityManager entityManager = // l·∫•y Entity Manager t·ª´ EntityManagerFactory
    
    EntityTransaction transaction = entityManager.getTransaction();
    transaction.begin(); // b·∫Øt ƒë·∫ßu transaction
    
    Employee employee = entityManager.find(Employee.class, id); // t√¨m ki·∫øm ƒë·ªëi t∆∞·ª£ng Employee theo id
    employee.setName(newName); // thay ƒë·ªïi t√™n c·ªßa Employee
    
    transaction.commit(); // k·∫øt th√∫c transaction v√† l∆∞u c√°c thay ƒë·ªïi v√†o c∆° s·ªü d·ªØ li·ªáu
}
```

Trong v√≠ d·ª• tr√™n:

* S·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `getTransaction()` c·ªßa **Entity Manager** ƒë·ªÉ l·∫•y **Entity Transaction**.
* B·∫Øt ƒë·∫ßu transaction b·∫±ng `begin()`.
* Th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu.
* Cu·ªëi c√πng g·ªçi `commit()` ƒë·ªÉ l∆∞u thay ƒë·ªïi v√†o c∆° s·ªü d·ªØ li·ªáu.



### 3.1.4 Qu·∫£n l√Ω Persistence Context

**Persistence Context** l√† m·ªôt trong nh·ªØng kh√°i ni·ªám quan tr·ªçng trong JPA, l√† m·ªôt v√πng nh·ªõ t·∫°m th·ªùi ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi **Entity Manager** v√† ch·ª©a c√°c ƒë·ªëi t∆∞·ª£ng ƒë√£ ƒë∆∞·ª£c truy xu·∫•t t·ª´ c∆° s·ªü d·ªØ li·ªáu.

Khi ch√∫ng ta l·∫•y m·ªôt ƒë·ªëi t∆∞·ª£ng t·ª´ c∆° s·ªü d·ªØ li·ªáu b·∫±ng Entity Manager, ƒë·ªëi t∆∞·ª£ng n√†y ƒë∆∞·ª£c l∆∞u trong Persistence Context.
Khi b·∫°n thay ƒë·ªïi ƒë·ªëi t∆∞·ª£ng trong Persistence Context, JPA s·∫Ω **t·ª± ƒë·ªông theo d√µi c√°c thay ƒë·ªïi n√†y** v√† c·∫≠p nh·∫≠t ch√∫ng v√†o c∆° s·ªü d·ªØ li·ªáu khi transaction k·∫øt th√∫c.



## 4. T·∫°i sao n√™n d√πng JPA

### 4.1 No-code Repository

M·ªôt trong nh·ªØng l·ª£i √≠ch l·ªõn nh·∫•t c·ªßa JPA l√† ch√∫ng ta **kh√¥ng c·∫ßn ph·∫£i vi·∫øt m√£ SQL hay DAO (Data Access Object)** ƒë·ªÉ l√†m vi·ªác v·ªõi c∆° s·ªü d·ªØ li·ªáu.
Thay v√†o ƒë√≥, JPA cung c·∫•p **Repository Interfaces** ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông CRUD.

**JPA cung c·∫•p c√°c ph∆∞∆°ng th·ª©c thao t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu - Ngu·ªìn: Sendvjs Medium**

#### V√≠ d·ª•

```java
@Repository
public interface EmployeeRepository extends JpaRepository<Employee, Long> {
    List<Employee> findAll();
}
```

ƒêi·ªÅu n√†y gi√∫p gi·∫£m thi·ªÉu r·∫•t nhi·ªÅu c√¥ng vi·ªác l·∫∑p l·∫°i v√† **m√£ boilerplate code** m√† ch√∫ng ta th∆∞·ªùng ph·∫£i vi·∫øt khi s·ª≠ d·ª•ng JDBC tr·ª±c ti·∫øp.



### 4.2 Kh·∫£ nƒÉng m·ªü r·ªông

V·ªõi JPA, ch√∫ng ta c√≥ th·ªÉ **thay ƒë·ªïi c∆° s·ªü d·ªØ li·ªáu m√† kh√¥ng c·∫ßn s·ª≠a ƒë·ªïi m√£ ngu·ªìn ·ª©ng d·ª•ng**.
ƒêi·ªÅu n√†y l√†m cho vi·ªác di ƒë·ªông gi·ªØa c√°c h·ªá th·ªëng c∆° s·ªü d·ªØ li·ªáu kh√°c nhau d·ªÖ d√†ng h∆°n.

Ngo√†i ra, JPA c√≤n cho ph√©p ch√∫ng ta m·ªü r·ªông ·ª©ng d·ª•ng d·ªÖ d√†ng b·∫±ng c√°ch **th√™m m·ªõi c√°c Entity v√† Repository** m√† kh√¥ng c·∫ßn ph·∫£i s·ª≠a ƒë·ªïi m√£ ngu·ªìn ƒë√£ c√≥.



## 5. So s√°nh JPA v√† Hibernate


JPA v√† Hibernate l√† hai kh√°i ni·ªám li√™n quan ƒë·∫øn **√°nh x·∫° quan h·ªá ƒë·ªëi t∆∞·ª£ng (ORM)** trong Java.
V·ªõi ORM, nh∆∞ ƒë√£ ƒë·ªÅ c·∫≠p ·ªü ph√≠a tr√™n, l√† m·ªôt k·ªπ thu·∫≠t cho ph√©p **chuy·ªÉn ƒë·ªïi c√°c ƒë·ªëi t∆∞·ª£ng Java th√†nh c√°c b·∫£n ghi trong c∆° s·ªü d·ªØ li·ªáu quan h·ªá v√† ng∆∞·ª£c l·∫°i**.

T·ª´ ƒë√≥, ch√∫ng ta c√≥ th·ªÉ th·∫•y ƒë∆∞·ª£c **JPA** v√† **Hibernate** c√≥ m·ªôt s·ªë ƒëi·ªÉm kh√°c nhau nh∆∞ sau:

| Ti√™u ch√≠               | JPA                                            | Hibernate                                                      |
| - | - | -- |
| **B·∫£n ch·∫•t**           | L√† m·ªôt ti√™u chu·∫©n (Specification)              | L√† m·ªôt tri·ªÉn khai (Implementation) c·ªßa JPA                     |
| **Ng√¥n ng·ªØ truy v·∫•n**  | JPQL (Java Persistence Query Language)         | HQL (Hibernate Query Language)                                 |
| **T√≠nh m·ªü r·ªông**       | Tu√¢n th·ªß ti√™u chu·∫©n, cung c·∫•p t√≠nh nƒÉng c∆° b·∫£n | M·ªü r·ªông ti√™u chu·∫©n JPA, cung c·∫•p th√™m nhi·ªÅu t√≠nh nƒÉng n√¢ng cao |
| **B·ªô nh·ªõ ƒë·ªám (Cache)** | H·ªó tr·ª£ 2 lo·∫°i: Entity Cache, Query Cache       | H·ªó tr·ª£ th√™m Collection Cache                                   |
| **T√≠nh t∆∞∆°ng th√≠ch**   | ƒê∆∞·ª£c h·ªó tr·ª£ b·ªüi t·∫•t c·∫£ c√°c nh√† cung c·∫•p JPA    | Ch·ªâ h·ªó tr·ª£ ri√™ng cho Hibernate                                 |

T√≥m l·∫°i, **JPA** v√† **Hibernate** l√† hai kh√°i ni·ªám li√™n quan nh∆∞ng kh√°c nhau v·ªÅ ORM trong Java:

* JPA l√† **m·ªôt ti√™u chu·∫©n cho ORM**.
* Hibernate l√† **m·ªôt tri·ªÉn khai c·ªßa JPA**, ƒë·ªìng th·ªùi m·ªü r·ªông JPA v·ªõi nhi·ªÅu t√≠nh nƒÉng m·∫°nh m·∫Ω h∆°n.

Tuy nhi√™n, vi·ªác s·ª≠ d·ª•ng c√°c t√≠nh nƒÉng d√†nh ri√™ng cho Hibernate c√≥ th·ªÉ g√¢y ra **s·ª± ph·ª• thu·ªôc v√†o nh√† cung c·∫•p** v√† **kh√≥ chuy·ªÉn ƒë·ªïi** sang c√°c tri·ªÉn khai JPA kh√°c.
Do ƒë√≥, ch√∫ng ta n√™n c√¢n nh·∫Øc k·ªπ tr∆∞·ªõc khi s·ª≠ d·ª•ng Hibernate ho·∫∑c JPA cho d·ª± √°n c·ªßa m√¨nh.

## 6. Hibernate

### 6.1 Hibernate l√† g√¨?

**Hibernate** l√† m·ªôt th∆∞ vi·ªán **ORM (Object Relational Mapping)** m√£ ngu·ªìn m·ªü gi√∫p l·∫≠p tr√¨nh vi√™n vi·∫øt ·ª©ng d·ª•ng Java c√≥ th·ªÉ **map c√°c objects (POJO)** v·ªõi **h·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu quan h·ªá**,  
v√† h·ªó tr·ª£ th·ª±c hi·ªán c√°c kh√°i ni·ªám **l·∫≠p tr√¨nh h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng** v·ªõi **c∆° s·ªü d·ªØ li·ªáu quan h·ªá**.

![alt text](img/hibernatearchi.png)


### 6.2 Hibernate 

#### 6.2.1 Persistence Object
Ch√≠nh l√† c√°c **POJO object** map v·ªõi c√°c **table** t∆∞∆°ng ·ª©ng c·ªßa c∆° s·ªü d·ªØ li·ªáu quan h·ªá.  
N√≥ nh∆∞ l√† nh·ªØng ‚Äúth√πng xe‚Äù ch·ª©a d·ªØ li·ªáu t·ª´ ·ª©ng d·ª•ng ƒë·ªÉ ghi xu·ªëng database, hay ch·ª©a d·ªØ li·ªáu t·∫£i l√™n ·ª©ng d·ª•ng t·ª´ database.

#### 6.2.2 Session Factory
L√† m·ªôt **interface** gi√∫p t·∫°o ra **session** k·∫øt n·ªëi ƒë·∫øn database b·∫±ng c√°ch ƒë·ªçc c√°c c·∫•u h√¨nh trong Hibernate configuration.  
M·ªói m·ªôt database ph·∫£i c√≥ m·ªôt **session factory**.

V√≠ d·ª•:  
N·∫øu ta s·ª≠ d·ª•ng **MySQL** v√† **Oracle** cho ·ª©ng d·ª•ng Java c·ªßa m√¨nh th√¨ ta c·∫ßn c√≥ m·ªôt `SessionFactory` cho MySQL, v√† m·ªôt `SessionFactory` cho Oracle.

#### 6.2.3 Hibernate Session
M·ªói m·ªôt ƒë·ªëi t∆∞·ª£ng `Session` ƒë∆∞·ª£c `SessionFactory` t·∫°o ra s·∫Ω t·∫°o **m·ªôt k·∫øt n·ªëi** ƒë·∫øn database.

#### 6.2.4 Transaction
L√† **transaction** ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn c·ªßa phi√™n l√†m vi·ªác v·ªõi c∆° s·ªü d·ªØ li·ªáu.  
T·ª©c l√† n·∫øu c√≥ m·ªôt l·ªói x·∫£y ra trong transaction th√¨ t·∫•t c·∫£ c√°c t√°c v·ª• th·ª±c hi·ªán s·∫Ω th·∫•t b·∫°i.

#### 6.2.5 Query
Hibernate cung c·∫•p c√°c c√¢u truy v·∫•n **HQL (Hibernate Query Language)** t·ªõi database v√† map k·∫øt qu·∫£ tr·∫£ v·ªÅ v·ªõi ƒë·ªëi t∆∞·ª£ng t∆∞∆°ng ·ª©ng c·ªßa ·ª©ng d·ª•ng Java.




### 6.3 T·∫°i sao ph·∫£i d√πng Hibernate thay JDBC

#### 6.3.1 Object Mapping
V·ªõi **JDBC** ta ph·∫£i map c√°c tr∆∞·ªùng trong b·∫£ng v·ªõi c√°c thu·ªôc t√≠nh c·ªßa Java object m·ªôt c√°ch **‚Äúth·ªß c√¥ng‚Äù**.  
V·ªõi **Hibernate**, vi·ªác n√†y ƒë∆∞·ª£c h·ªó tr·ª£ **‚Äút·ª± ƒë·ªông‚Äù** th√¥ng qua c√°c file c·∫•u h√¨nh map XML ho·∫∑c s·ª≠ d·ª•ng **annotation**.

#### JDBC s·∫Ω map Java object v·ªõi table nh∆∞ sau:

```java
// rs l√† ResultSet tr·∫£ v·ªÅ t·ª´ c√¢u query get d·ªØ li·ªáu b·∫£ng user.
List users = new ArrayList();
while (rs.next()) {
     User user = new User();
     user.setUserId(rs.getString("userNo"));
     user.setName(rs.getString("firstName"));
     user.setEmail(rs.getString("lastName"));
     users.add(user);
}
```

####  C≈©ng v·ªõi table user ƒë√≥, s·ª≠ d·ª•ng annotation ƒë·ªÉ Hibernate map ‚Äút·ª± ƒë·ªông‚Äù:

```java
@Entity
@Table(name = "user")
public class UserModel {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private BigInteger userNo;

    @NotEmpty
    @Column(name = "lastName")
    private String email;

    public BigInteger getUserNo() {
        return this.userNo;
    }
    public void setUserNo(BigInteger userNo) {
        this.userNo = userNo;
    }
    public String getLastName() {
        return lastName;
    }
    public void setLastName(String lastName) {
        this.lastName = lastName;
    }
}
```



#### 6.3.2 HQL

Hibernate cung c·∫•p c√°c c√¢u l·ªánh truy v·∫•n t∆∞∆°ng t·ª± SQL.
HQL c·ªßa Hibernate h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß c√°c truy v·∫•n ƒëa h√¨nh: **k·∫ø th·ª´a (inheritance)**, **ƒëa h√¨nh (polymorphism)**, v√† **li√™n k·∫øt (association)**.



#### 6.3.3 Database Independent

Code s·ª≠ d·ª•ng Hibernate l√† **ƒë·ªôc l·∫≠p v·ªõi h·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu**,
nghƒ©a l√† ta kh√¥ng c·∫ßn thay ƒë·ªïi c√¢u l·ªánh HQL khi chuy·ªÉn t·ª´ MySQL sang Oracle hay c√°c h·ªá qu·∫£n tr·ªã kh√°c.
Ch·ªâ c·∫ßn thay ƒë·ªïi th√¥ng tin c·∫•u h√¨nh trong file c·∫•u h√¨nh.

```properties
# used MySQL
com.mysql.jdbc.Driver

# used Oracle
oracle.jdbc.driver.OracleDriver
```

#### V√≠ d·ª•:

Khi mu·ªën l·∫•y 10 b·∫£n ghi d·ªØ li·ªáu c·ªßa m·ªôt table t·ª´ 2 CSDL kh√°c nhau:

**V·ªõi JDBC:**

```sql
# MySQL
SELECT column_name FROM table_name ORDER BY column_name ASC LIMIT 10; 

# SQL Server 
SELECT TOP 10 column_name FROM table_name ORDER BY column_name ASC;
```

**V·ªõi Hibernate:**

```java
session.createQuery("SELECT E.id FROM Employee E ORDER BY E.id ASC")
       .setMaxResults(10)
       .list();
```

C√¢u truy v·∫•n **kh√¥ng thay ƒë·ªïi** d√π b·∫°n d√πng MySQL hay SQL Server.



#### 6.3.4 Minimize Code Changes

Khi ta thay ƒë·ªïi (th√™m) c·ªôt v√†o b·∫£ng:

**V·ªõi JDBC, ta ph·∫£i thay ƒë·ªïi:**

* Th√™m thu·ªôc t√≠nh v√†o POJO class.
* Thay ƒë·ªïi method ch·ª©a c√¢u truy v·∫•n ‚Äúselect‚Äù, ‚Äúinsert‚Äù, ‚Äúupdate‚Äù ƒë·ªÉ b·ªï sung c·ªôt m·ªõi.
* C√≥ th·ªÉ c√≥ r·∫•t nhi·ªÅu method, nhi·ªÅu class ch·ª©a c√°c c√¢u truy v·∫•n nh∆∞ tr√™n.

**V·ªõi Hibernate, ta ch·ªâ c·∫ßn:**

* Th√™m thu·ªôc t√≠nh v√†o POJO class.
* C·∫≠p nh·∫≠t Hibernate XML mapping file ƒë·ªÉ th√™m map column ‚Äì property.

‚Üí Ch·ªâ thay ƒë·ªïi **2 file** l√† xong.



#### 6.3.5 Lazy Loading

V·ªõi nh·ªØng ·ª©ng d·ª•ng Java l√†m vi·ªác v·ªõi c∆° s·ªü d·ªØ li·ªáu l·ªõn h√†ng trƒÉm tri·ªáu b·∫£n ghi, vi·ªác s·ª≠ d·ª•ng **Lazy Loading** mang l·∫°i l·ª£i √≠ch r·∫•t l·ªõn.
N√≥ gi·ªëng nh∆∞ vi·ªác ta c√≥ th·ªÉ **b·∫ª t·ª´ng chi·∫øc ƒë≈©a** c·ªßa b√≥ ƒë≈©a to thay v√¨ b·∫ª c·∫£ b√≥ c√πng l√∫c.

V√≠ d·ª•:
B·∫£ng `user` c√≥ quan h·ªá **m·ªôt-nhi·ªÅu** v·ªõi b·∫£ng `document`.
N·∫øu d·ªØ li·ªáu document r·∫•t l·ªõn, vi·ªác load to√†n b·ªô c√πng l√∫c s·∫Ω t·ªën b·ªô nh·ªõ.
Hibernate cho ph√©p ta **ch·ªâ t·∫£i d·ªØ li·ªáu khi c·∫ßn**:

```java
@OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
private Set documents = new HashSet();

// L·∫•y user
User user = (User) session.get(User.class, new Integer(100));

// L√∫c n√†y Hibernate m·ªõi fetch documents cho user 100
documents = user.getDocuments();
```



#### 6.3.6 Lo·∫°i b·ªè Try-Catch Blocks

Khi thao t√°c v·ªõi JDBC, n·∫øu l·ªói x·∫£y ra s·∫Ω c√≥ `SQLException` b·∫Øn ra, n√™n ta ph·∫£i d√πng `try-catch` ƒë·ªÉ x·ª≠ l√Ω.
Hibernate x·ª≠ l√Ω vi·ªác n√†y b·∫±ng c√°ch **override to√†n b·ªô JDBC exception** th√†nh **Unchecked Exception**,
v√¨ v·∫≠y ta **kh√¥ng c·∫ßn vi·∫øt try-catch** trong code n·ªØa.



#### 6.3.7 Qu·∫£n l√Ω Commit/Rollback Transaction

**Transaction** l√† nh√≥m c√°c ho·∫°t ƒë·ªông v·ªõi database c·ªßa m·ªôt t√°c v·ª•.
N·∫øu m·ªôt ho·∫°t ƒë·ªông th·∫•t b·∫°i th√¨ to√†n b·ªô t√°c v·ª• c≈©ng th·∫•t b·∫°i.

**V·ªõi JDBC:**

* L·∫≠p tr√¨nh vi√™n ph·∫£i ch·ªß ƒë·ªông g·ªçi `commit` ho·∫∑c `rollback`.

**V·ªõi Hibernate:**

* Hibernate **t·ª± ƒë·ªông qu·∫£n l√Ω transaction**, gi√∫p ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn d·ªØ li·ªáu.



#### 6.3.8 Hibernate Caching

Hibernate cung c·∫•p c∆° ch·∫ø **b·ªô nh·ªõ ƒë·ªám (cache)** gi√∫p **gi·∫£m s·ªë l·∫ßn truy c·∫≠p database**,
t·ª´ ƒë√≥ **tƒÉng hi·ªáu nƒÉng** cho ·ª©ng d·ª•ng.

* Hibernate l∆∞u tr·ªØ c√°c ƒë·ªëi t∆∞·ª£ng trong session khi transaction ƒë∆∞·ª£c k√≠ch ho·∫°t.
* Khi m·ªôt query ƒë∆∞·ª£c th·ª±c hi·ªán li√™n t·ª•c, gi√° tr·ªã ƒë√£ l∆∞u trong session ƒë∆∞·ª£c s·ª≠ d·ª•ng l·∫°i.
* Khi m·ªôt transaction m·ªõi b·∫Øt ƒë·∫ßu, d·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y l·∫°i t·ª´ database v√† ƒë∆∞·ª£c l∆∞u v√†o session m·ªõi.

Hibernate cung c·∫•p **hai c·∫•p ƒë·ªô cache**:

* **Level 1 Cache** (m·∫∑c ƒë·ªãnh, theo session)
* **Level 2 Cache** (chia s·∫ª gi·ªØa c√°c session)



# Ki·∫øn tr√∫c 4 l·ªõp Spring Boot
D∆∞·ªõi ƒë√¢y m√¨nh **format l·∫°i to√†n b·ªô n·ªôi dung**, **b·ªï sung v√≠ d·ª• ƒë·∫ßy ƒë·ªß**, **di·ªÖn gi·∫£i d·ªÖ hi·ªÉu**, v√† **s·∫Øp x·∫øp l·∫°i cho chu·∫©n ki·∫øn tr√∫c Spring Boot 4 l·ªõp**.



## **Ki·∫øn tr√∫c Spring Boot ‚Äì 4 L·ªõp (Spring Boot Architecture 4 Layers)**

Ki·∫øn tr√∫c Spring Boot truy·ªÅn th·ªëng ƒë∆∞·ª£c chia th√†nh **4 l·ªõp**:

1. **Presentation Layer (Controller)**
2. **Business Layer (Service)**
3. **Persistence Layer (Repository/DAO)**
4. **Database Layer (Database th·ª±c t·∫ø)**

ƒê√¢y l√† m√¥ h√¨nh chu·∫©n cho c√°c ·ª©ng d·ª•ng RESTful trong doanh nghi·ªáp, gi√∫p code r√µ r√†ng, d·ªÖ b·∫£o tr√¨, d·ªÖ m·ªü r·ªông.

![alt text](img/structsp.png)

#  **1. L·ªõp Presentation (Controller Layer)**

### ‚úî Vai tr√≤ ch√≠nh:

* Nh·∫≠n **HTTP request** t·ª´ client.
* X√°c th·ª±c ƒë∆°n gi·∫£n (authentication forwarding).
* Chuy·ªÉn ƒë·ªïi **JSON ‚Üí Object** v√† **Object ‚Üí JSON**.
* G·ªçi xu·ªëng l·ªõp Business (Service).
* Tr·∫£ v·ªÅ **HTTP response** cho client.

### ‚úî T∆∞∆°ng ·ª©ng v·ªõi:

üëâ **Controller (@RestController)**

### ‚úî Kh√¥ng l√†m:

‚úò Kh√¥ng x·ª≠ l√Ω logic nghi·ªáp v·ª•
‚úò Kh√¥ng validate ph·ª©c t·∫°p
‚úò Kh√¥ng truy c·∫≠p database



###  **V√≠ d·ª• Controller:**

```java
@RestController
@RequestMapping("/api/students")
public class StudentController {

    private final StudentService studentService;

    public StudentController(StudentService studentService) {
        this.studentService = studentService;
    }

    @GetMapping("/{id}")
    public ResponseEntity<Student> getStudentById(@PathVariable Long id) {
        Student student = studentService.getStudent(id);
        return ResponseEntity.ok(student);
    }

    @PostMapping
    public ResponseEntity<Student> create(@RequestBody StudentDTO dto) {
        Student student = studentService.createStudent(dto);
        return ResponseEntity.ok(student);
    }
}
```



# **2. L·ªõp Business (Service Layer)**

### ‚úî Vai tr√≤:

* X·ª≠ l√Ω to√†n b·ªô **logic nghi·ªáp v·ª•** (business logic).
* Th·ª±c hi·ªán **validation** n√¢ng cao.
* Th·ª±c hi·ªán **authorization** (quy·ªÅn truy c·∫≠p).
* G·ªçi xu·ªëng l·ªõp Persistence.
* √Åp d·ª•ng c√°c quy t·∫Øc nghi·ªáp v·ª• c·ªßa h·ªá th·ªëng.

### ‚úî T∆∞∆°ng ·ª©ng v·ªõi:

üëâ **Service (@Service)**

### ‚úî Kh√¥ng l√†m:

‚úò Kh√¥ng x·ª≠ l√Ω request/response
‚úò Kh√¥ng thao t√°c SQL tr·ª±c ti·∫øp



###  **V√≠ d·ª• Service:**

```java
@Service
public class StudentService {

    @Autowired
    private StudentRepository studentRepository;

    public Student getStudent(Long id) {
        return studentRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Student not found"));
    }

    public Student createStudent(StudentDTO dto) {
        if (dto.getAge() < 18) {
            throw new IllegalArgumentException("Age must be >= 18");
        }

        Student student = new Student();
        student.setName(dto.getName());
        student.setAge(dto.getAge());
        return studentRepository.save(student);
    }
}
```



#  **3. L·ªõp Persistence (Repository / DAO Layer)**

### ‚úî Vai tr√≤:

* Giao ti·∫øp v·ªõi database.
* Th·ª±c hi·ªán CRUD.
* Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu: **Entity ‚Üî Database row**.
* Ch·∫°y c√°c truy v·∫•n (JPA, JPQL, Query Methods, Native SQL).

### ‚úî T∆∞∆°ng ·ª©ng v·ªõi:

üëâ **Repository (@Repository)**
üëâ Interface extends `JpaRepository`

### ‚úî Kh√¥ng l√†m:

‚úò Kh√¥ng vi·∫øt logic nghi·ªáp v·ª•
‚úò Kh√¥ng x·ª≠ l√Ω HTTP request



###  **V√≠ d·ª• Repository:**

```java
@Repository
public interface StudentRepository extends JpaRepository<Student, Long> {

    List<Student> findByAgeGreaterThan(int age);

    @Query("SELECT s FROM Student s WHERE s.name LIKE %:name%")
    List<Student> searchByName(@Param("name") String name);
}
```



#  **4. L·ªõp Database (Data Layer)**

###  Vai tr√≤:

* L∆∞u tr·ªØ d·ªØ li·ªáu c·ªßa ·ª©ng d·ª•ng.
* X·ª≠ l√Ω CRUD qua Hibernate/JPA ho·∫∑c driver.
* C√≥ th·ªÉ l√†:

  * MySQL
  * PostgreSQL
  * SQL Server
  * Oracle
  * MongoDB
  * Redis

###  ƒê√¢y l√† l·ªõp **ngo·∫°i vi**, kh√¥ng thu·ªôc code Spring Boot.

**‚Üí ·ª®ng d·ª•ng giao ti·∫øp qua Persistence Layer.**



## **Workflow (Lu·ªìng ho·∫°t ƒë·ªông c·ªßa Spring Boot)**

![alt text](img/wordflow.png)
###  Di·ªÖn gi·∫£i workflow:

1. Client g·ª≠i HTTP Request (GET/POST/PUT/DELETE).
2. **Controller** nh·∫≠n request ‚Üí parse JSON ‚Üí g·ªçi Service.
3. **Service** x·ª≠ l√Ω logic ‚Üí validate ‚Üí ki·ªÉm tra rule ‚Üí g·ªçi Repository.
4. **Repository** ch·∫°y SQL/JPA ‚Üí truy v·∫•n Database.
5. Database tr·∫£ d·ªØ li·ªáu cho Repository ‚Üí Service ‚Üí Controller.
6. Controller tr·∫£ v·ªÅ JSON Response cho client.



## V√≠ d·ª• m·ªôt workflow th·ª±c t·∫ø:

Client g·ª≠i request:

```
POST /api/students
{
  "name": "Long",
  "age": 20
}
```

**‚Üí Controller** nh·∫≠n request ‚Üí chuy·ªÉn sang DTO ‚Üí g·ªçi Service
**‚Üí Service** validate tu·ªïi, t·∫°o Student ‚Üí g·ªçi Repository
**‚Üí Repository** l∆∞u v√†o database
**‚Üí Controller** tr·∫£ v·ªÅ JSON:

```json
{
  "id": 5,
  "name": "Long",
  "age": 20
}
```


# Request flow (d√≤ng ch·∫£y x·ª≠ l√Ω request)


## üöÄ **REQUEST FLOW TRONG SPRING BOOT (D√íNG CH·∫¢Y X·ª¨ L√ù REQUEST)**

Request Flow m√¥ t·∫£ **t·ª´ng b∆∞·ªõc** m√† m·ªôt HTTP Request ƒëi qua trong Spring Boot, t·ª´ l√∫c ƒëi v√†o ·ª©ng d·ª•ng üëâ cho ƒë·∫øn l√∫c tr·∫£ v·ªÅ Response.

Spring Boot d√πng Spring MVC, n√™n request flow g·ªìm **12 b∆∞·ªõc ch√≠nh** sau:



# üß≠ **T√ìM T·∫ÆT REQUEST FLOW ‚Äì 1 H√åNH MINH H·ªåA**

```
Browser/Client
      ‚Üì
DispatcherServlet
      ‚Üì
HandlerMapping
      ‚Üì
Handler (Controller)
      ‚Üì
Service Layer
      ‚Üì
Repository Layer
      ‚Üì
Database
      ‚Üë
Response (Reverse Flow)
```



# üß© **1. Client g·ª≠i HTTP Request**

Client c√≥ th·ªÉ l√†:

* Browser (Chrome, Firefox‚Ä¶)
* Mobile App
* Postman
* React / Angular / Vue

V√≠ d·ª• request:

```
GET /api/students/10
Host: localhost:8080
```



# üè∞ **2. Request ƒëi v√†o Servet Container (Tomcat Embedded)**

M·∫∑c ƒë·ªãnh Spring Boot d√πng **Tomcat embedded**.
Tomcat nh·∫≠n request tr∆∞·ªõc, r·ªìi chuy·ªÉn request cho Spring qua DispatcherServlet.



# üö¶ **3. DispatcherServlet ‚Äì ‚ÄúB·ªô ƒëi·ªÅu ph·ªëi trung t√¢m‚Äù**

**DispatcherServlet** l√† tr√°i tim c·ªßa Spring MVC.

N√≥ ch·ªãu tr√°ch nhi·ªám:

* Nh·∫≠n request
* T√¨m ƒë√∫ng Controller
* G·ªçi handler t∆∞∆°ng ·ª©ng
* X·ª≠ l√Ω exception
* Render response

üìå M·∫∑c ƒë·ªãnh ƒë∆∞·ª£c t·∫°o b·ªüi `@SpringBootApplication`.



# üó∫ **4. HandlerMapping ‚Äì T√¨m Controller ph√π h·ª£p**

Spring d√πng HandlerMapping ƒë·ªÉ t√¨m xem request c·∫ßn ƒëi t·ªõi controller n√†o.

V√≠ d·ª• mapping:

```java
@GetMapping("/students/{id}")
public Student getById(@PathVariable Long id) { ... }
```

N·∫øu request l√†:

```
GET /students/5
```

‚Üí HandlerMapping tr·∫£ v·ªÅ method `getById`.



# üß© **5. HandlerAdapter ‚Äì K√≠ch ho·∫°t controller**

Spring c·∫ßn m·ªôt adapter ƒë·ªÉ ch·∫°y method Controller.
‚Üí HandlerAdapter g·ªçi ƒë√∫ng h√†m t∆∞∆°ng ·ª©ng.



# üìù **6. Web Argument Resolver ‚Äì G√°n tham s·ªë method**

Method controller c√≥ tham s·ªë:

```java
public Student getById(@PathVariable Long id)
```

Spring ph·∫£i:

* Parse URL
* L·∫•y `{id}`
* Convert ‚Äú5‚Äù ‚Üí Long
* Truy·ªÅn v√†o h√†m

Vi·ªác n√†y do ArgumentResolver x·ª≠ l√Ω.



# üéõ **7. Controller x·ª≠ l√Ω request**

Controller l√† n∆°i:

* Nh·∫≠n request
* L·∫•y tham s·ªë
* Validate ƒë∆°n gi·∫£n
* G·ªçi service

Kh√¥ng x·ª≠ l√Ω logic nghi·ªáp v·ª•.

V√≠ d·ª•:

```java
@RestController
@RequestMapping("/api/students")
public class StudentController {

    @Autowired
    private StudentService service;

    @GetMapping("/{id}")
    public Student getById(@PathVariable Long id) {
        return service.getStudent(id);
    }
}
```



# üß† **8. Service Layer ‚Äì X·ª≠ l√Ω logic nghi·ªáp v·ª•**

Service l√† n∆°i th·ª±c hi·ªán:

* Business logic
* Validation nghi·ªáp v·ª•
* Authorization
* T√≠nh to√°n
* G·ªçi Repository

V√≠ d·ª•:

```java
@Service
public class StudentService {

    @Autowired
    private StudentRepository repo;

    public Student getStudent(Long id) {
        return repo.findById(id)
            .orElseThrow(() -> new RuntimeException("Not found"));
    }
}
```



# üóÑ **9. Repository Layer ‚Äì Giao ti·∫øp database**

Repository d√πng JPA/Hibernate ƒë·ªÉ truy v·∫•n DB.

```java
@Repository
public interface StudentRepository extends JpaRepository<Student, Long> {}
```

Spring t·ª± ƒë·ªông:

* M·ªü transaction
* K·∫øt n·ªëi DB
* T·∫°o SQL t·ª´ JPA
* Tr·∫£ k·∫øt qu·∫£



# üõ¢ **10. Database ‚Äì Th·ª±c hi·ªán CRUD**

V√≠ d·ª• query Hibernate s·∫Ω ch·∫°y:

```sql
select * from student where id = 10;
```

Data tr·∫£ v·ªÅ d∆∞·ªõi d·∫°ng ResultSet, Hibernate convert th√†nh **Entity**.



# üîô **11. Response Flow ‚Äì Quay ng∆∞·ª£c l·∫°i l√™n tr√™n**

D·ªØ li·ªáu ƒëi ng∆∞·ª£c:

```
Database
‚Üí Repository
‚Üí Service
‚Üí Controller
‚Üí DispatcherServlet
‚Üí Client
```



# üì§ **12. Response ƒë∆∞·ª£c tr·∫£ v·ªÅ client**

Spring s·ª≠ d·ª•ng:

* **HttpMessageConverter**
* **Jackson** (convert object ‚Üí JSON)

V√≠ d·ª• response:

```json
{
  "id": 10,
  "name": "Long",
  "age": 20
}
```



# üí° **MINH H·ªåA REQUEST FLOW ƒê·∫¶Y ƒê·ª¶**

```
[ Client ]
    |
    v
[ Tomcat Embedded ]
    |
    v
[ DispatcherServlet ]
    |
    v
[ HandlerMapping ] ‚Üí t√¨m Controller ph√π h·ª£p
    |
    v
[ HandlerAdapter ] ‚Üí g·ªçi ph∆∞∆°ng th·ª©c
    |
    v
[ Controller ]
    |
    v
[ Service Layer ]
    |
    v
[ Repository Layer ]
    |
    v
[ Database ]
    |
    v
< Response (JSON) 
```



# üéØ **V√ç D·ª§ REQUEST FLOW TH·ª∞C T·∫æ (CRUD)**

### Client g·ª≠i:

```
POST /api/students
{
  "name": "Long",
  "age": 21
}
```

### Flow:

1. Browser ‚Üí g·ª≠i request
2. Tomcat nh·∫≠n request
3. DispatcherServlet x·ª≠ l√Ω
4. HandlerMapping t√¨m `createStudent()`
5. ArgumentResolver parse JSON ‚Üí DTO
6. Controller g·ªçi Service
7. Service x·ª≠ l√Ω validate ‚Üí t·∫°o entity
8. Repository g·ªçi Hibernate ‚Üí SQL INSERT
9. Database l∆∞u record
10. Hibernate tr·∫£ entity
11. Service tr·∫£ k·∫øt qu·∫£
12. Controller tr·∫£ JSON
13. Client nh·∫≠n response

### Response:

```json
{
  "id": 25,
  "name": "Long",
  "age": 21
}
```



# C·∫•u h√¨nh DataSource

## 1. DataSource l√† g√¨?

DataSource ho·∫°t ƒë·ªông nh∆∞ m·ªôt factory ƒë·ªÉ cung c·∫•p c√°c k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu. N√≥ l√† m·ªôt c√°ch thay th·∫ø cho c∆° ch·∫ø DriverManager. M·ªôt datasource s·ª≠ d·ª•ng URL c√πng v·ªõi th√¥ng tin username/password ƒë·ªÉ thi·∫øt l·∫≠p k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu.

Trong Java, m·ªôt datasource tri·ªÉn khai interface `javax.sql.DataSource`. Datasource n√†y th∆∞·ªùng ƒë∆∞·ª£c ƒëƒÉng k√Ω v√†o d·ªãch v·ª• JNDI v√† c√≥ th·ªÉ ƒë∆∞·ª£c l·∫•y ra b·∫±ng t√™n JNDI c·ªßa n√≥.

Ch√∫ng ta c√≥ th·ªÉ d√πng m·ªôt datasource ƒë·ªÉ l·∫•y:

* ƒë·ªëi t∆∞·ª£ng Connection ti√™u chu·∫©n
* m·ªôt k·∫øt n·ªëi c√≥ th·ªÉ d√πng trong connection pooling
* m·ªôt k·∫øt n·ªëi c√≥ th·ªÉ d√πng trong distributed transactions v√† connection pooling



## 2. C·∫•u h√¨nh DataSource trong Spring Boot

Spring Boot cho ph√©p ƒë·ªãnh nghƒ©a c·∫•u h√¨nh datasource theo c√°c c√°ch sau:

* Java bean configuration
* Properties configuration
* JNDI configuration

Trong qu√° tr√¨nh kh·ªüi ƒë·ªông ·ª©ng d·ª•ng, `DataSourceAutoConfiguration` ki·ªÉm tra `DataSource.class` (ho·∫∑c `EmbeddedDatabaseType.class`) tr√™n classpath v√† m·ªôt s·ªë y·∫øu t·ªë kh√°c tr∆∞·ªõc khi t·ª± ƒë·ªông c·∫•u h√¨nh m·ªôt bean DataSource cho ch√∫ng ta.



### 2.1. Maven Dependency

N·∫øu ch∆∞a ƒë∆∞·ª£c khai b√°o, th√™m `spring-boot-starter-data-jpa` v√†o project ƒë·ªÉ mang theo t·∫•t c·∫£ dependency c·∫ßn thi·∫øt, bao g·ªìm c·∫£ c√°c JDBC drivers nh∆∞ `mysql-connector-java` ƒë·ªÉ k·∫øt n·ªëi MySQL.

**pom.xml**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
```

N·∫øu ch√∫ng ta c√≥ k·∫ø ho·∫°ch s·ª≠ d·ª•ng **embedded database** ·ªü m·ªôt s·ªë b∆∞·ªõc (v√≠ d·ª• testing), ch√∫ng ta c√≥ th·ªÉ import H2 ri√™ng.



### 2.2. Properties Configuration

C·∫•u h√¨nh DataSource ƒë∆∞·ª£c cung c·∫•p b·ªüi c√°c entries c·∫•u h√¨nh (spring.datasource.*) trong file `application.properties`. C√°ch c·∫•u h√¨nh b·∫±ng properties gi√∫p t√°ch bi·ªát c·∫•u h√¨nh kh·ªèi m√£ ngu·ªìn ·ª©ng d·ª•ng. Nh·ªù v·∫≠y, ch√∫ng ta c√≥ th·ªÉ import c·∫•u h√¨nh datasource t·ª´ c√°c h·ªá th·ªëng cung c·∫•p configuration b√™n ngo√†i.

D∆∞·ªõi ƒë√¢y l√† c·∫•u h√¨nh m·∫´u cho H2, MySQL, Oracle v√† SQL Server.

Ch√∫ng ta th∆∞·ªùng kh√¥ng c·∫ßn ch·ªâ ƒë·ªãnh `driver-class-name`, v√¨ Spring Boot c√≥ th·ªÉ suy ra t·ª´ connection URL ƒë·ªëi v·ªõi h·∫ßu h·∫øt database.

**application.properties**

```properties
# H2 DB
spring.datasource.url=jdbc:h2:file:C:/temp/test
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.driverClassName=org.h2.Driver
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# MySQL
spring.datasource.url=jdbc:mysql://localhost:3306/test
spring.datasource.username=dbuser
spring.datasource.password=dbpass
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect

# Oracle
spring.datasource.url=jdbc:oracle:thin:@localhost:1521:orcl
spring.datasource.username=dbuser
spring.datasource.password=dbpass
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.jpa.database-platform=org.hibernate.dialect.Oracle10gDialect

# SQL Server
spring.datasource.url=jdbc:sqlserver://localhost;databaseName=springbootdb
spring.datasource.username=dbuser
spring.datasource.password=dbpass
spring.datasource.driverClassName=com.microsoft.sqlserver.jdbc.SQLServerDriver
spring.jpa.hibernate.dialect=org.hibernate.dialect.SQLServer2012Dialect
```



### 2.3. Java Configuration

C√°ch ƒë∆∞·ª£c khuy·∫øn ngh·ªã ƒë·ªÉ t·∫°o m·ªôt DataSource bean l√† s·ª≠ d·ª•ng `DataSourceBuilder` trong m·ªôt l·ªõp ƒë∆∞·ª£c ƒë√°nh d·∫•u `@Configuration`.

D∆∞·ªõi ƒë√¢y l√† v√≠ d·ª• kh·ªüi t·∫°o bean cho H2. Nh·ªØng bean kh√°c c≈©ng ƒë∆∞·ª£c c·∫•u h√¨nh t∆∞∆°ng t·ª±.

```java
@Configuration
public class JpaConfig {

    @Bean
    public DataSource dataSource()
    {
        DataSourceBuilder dataSourceBuilder = DataSourceBuilder.create();
        dataSourceBuilder.driverClassName("org.h2.Driver");
        dataSourceBuilder.url("jdbc:h2:file:C:/temp/test");
        dataSourceBuilder.username("sa");
        dataSourceBuilder.password("");
        return dataSourceBuilder.build();
    }

    //...
}
```



### 2.4. JNDI DataSource

Gi·∫£ s·ª≠ ch√∫ng ta deploy ·ª©ng d·ª•ng Spring Boot l√™n application server. Trong tr∆∞·ªùng h·ª£p ƒë√≥, ta c√≥ th·ªÉ mu·ªën c·∫•u h√¨nh v√† qu·∫£n l√Ω DataSource b·∫±ng t√≠nh nƒÉng c√≥ s·∫µn c·ªßa Application Server v√† truy c·∫≠p n√≥ th√¥ng qua JNDI.

Ta c√≥ th·ªÉ l√†m ƒëi·ªÅu n√†y b·∫±ng property:

```properties
spring.datasource.jndi-name = java:jboss/datasources/testDB
```



## 3. C·∫•u h√¨nh Connection Pooling

ƒê·ªÉ t·∫°o m·ªôt pooling datasource, Spring Boot x√°c minh r·∫±ng m·ªôt l·ªõp Driver h·ª£p l·ªá t·ªìn t·∫°i. L∆∞u √Ω r·∫±ng n·∫øu ta thi·∫øt l·∫≠p property `spring.datasource.driver-class-name` th√¨ driver class ph·∫£i t·ªìn t·∫°i v√† ƒë∆∞·ª£c load.

Auto-configuration s·∫Ω ch·ªçn k·∫øt n·ªëi theo th·ª© t·ª± ∆∞u ti√™n:

1. **HikariCP** ‚Äî n·∫øu c√≥, Spring Boot lu√¥n ch·ªçn.
2. N·∫øu kh√¥ng c√≥ HikariCP, s·ª≠ d·ª•ng **Tomcat Pooling** n·∫øu t√¨m th·∫•y.
3. N·∫øu kh√¥ng c√≥ c·∫£ hai, d√πng **Commons DBCP2** n·∫øu c√≥ trong classpath.

Starter `spring-boot-starter-data-jpa` t·ª± ƒë·ªông k√©o dependency c·ªßa HikariCP.



### 3.1. HikariCP l√† Connection Pool m·∫∑c ƒë·ªãnh

N·∫øu ta d√πng `spring-boot-starter-data-jpa`, ta kh√¥ng c·∫ßn th√™m dependency HikariCP v√¨ n√≥ ƒë∆∞·ª£c ƒë∆∞a v√†o t·ª± ƒë·ªông.

Khi d√πng starter n√†y, Spring Boot s·∫Ω t·ª± ƒë·ªông c·∫•u h√¨nh HikariCP v·ªõi c√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh h·ª£p l√Ω. Ta c√≥ th·ªÉ t√πy ch·ªânh b·∫±ng c√°ch thay prefix th√†nh:

```
spring.datasource.hikari.*
spring.datasource.tomcat.*
spring.datasource.dbcp2.*
```

V√≠ d·ª•:

```properties
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=collection-pool

# Other Properties

#spring.datasource.hikari.allow-pool-suspension
#spring.datasource.hikari.auto-commit
#spring.datasource.hikari.catalog
#spring.datasource.hikari.connection-init-sql
#spring.datasource.hikari.connection-test-query
#spring.datasource.hikari.data-source-class-name
#spring.datasource.hikari.data-source-j-n-d-i
#spring.datasource.hikari.data-source-properties
#spring.datasource.hikari.driver-class-name
#spring.datasource.hikari.exception-override-class-name
#spring.datasource.hikari.health-check-properties
#spring.datasource.hikari.initialization-fail-timeout
#spring.datasource.hikari.isolate-internal-queries
#spring.datasource.hikari.jdbc-url
#spring.datasource.hikari.keepalive-time
#spring.datasource.hikari.leak-detection-threshold
#spring.datasource.hikari.login-timeout
#spring.datasource.hikari.metrics-tracker-factory
#spring.datasource.hikari.password
#spring.datasource.hikari.read-only
#spring.datasource.hikari.register-mbeans
#spring.datasource.hikari.scheduled-executor
#spring.datasource.hikari.schema
#spring.datasource.hikari.transaction-isolation
#spring.datasource.hikari.username
#spring.datasource.hikari.validation-timeout
```



### 3.2. DBCP2

ƒê·ªÉ d√πng Commons DBCP2 trong Spring Boot, th√™m dependency:

```xml
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-dbcp2</artifactId>
</dependency>
```

Sau ƒë√≥ t√πy ch·ªânh pool:

```properties
spring.datasource.dbcp2.initial-size = 50
spring.datasource.dbcp2.max-idle = 50
spring.datasource.dbcp2.default-query-timeout = 10000
spring.datasource.dbcp2.default-auto-commit = true
```



### 3.3. Customizing Default Values ‚Äì Tomcat Pooling

Tomcat Pooling l√† connection pool c·ªßa Apache Tomcat. Th√™m dependency:

```xml
<dependency>
    <groupId>org.apache.tomcat</groupId>
    <artifactId>tomcat-jdbc</artifactId>
</dependency>
```

T√πy ch·ªânh:

```properties
spring.datasource.tomcat.initial-size=5
spring.datasource.tomcat.max-active=10
```



## 4. C·∫•u h√¨nh Multiple DataSources trong Spring Boot

ƒê·ªÉ c·∫•u h√¨nh nhi·ªÅu datasource, t·∫°o nhi·ªÅu bean v√† ƒë√°nh d·∫•u **m·ªôt bean l√† @Primary**.

Nh·ªõ r·∫±ng: n·∫øu ta t·ª± t·∫°o bean DataSource, auto-configuration s·∫Ω **kh√¥ng ch·∫°y n·ªØa**. Khi ƒë√≥ ta ph·∫£i t·ª± ch·ªãu tr√°ch nhi·ªám c·∫•u h√¨nh t·∫•t c·∫£ datasource.

**JpaConfig.java**

```java
@Configuration
public class JpaConfig {

    @Bean(name = "h2DataSource")
    public DataSource h2DataSource()
    {
        DataSourceBuilder dataSourceBuilder = DataSourceBuilder.create();
        dataSourceBuilder.driverClassName("org.h2.Driver");
        dataSourceBuilder.url("jdbc:h2:file:C:/temp/test");
        dataSourceBuilder.username("sa");
        dataSourceBuilder.password("");
        return dataSourceBuilder.build();
    }

    @Bean(name = "mysqlDataSource")
    @Primary
    public DataSource mysqlDataSource()
    {
        DataSourceBuilder dataSourceBuilder = DataSourceBuilder.create();
        dataSourceBuilder.url("jdbc:mysql://localhost/testdb");
        dataSourceBuilder.username("dbuser");
        dataSourceBuilder.password("dbpass");
        return dataSourceBuilder.build();
    }
}
```

Khi autowire, Spring Boot s·∫Ω ∆∞u ti√™n datasource ƒë∆∞·ª£c ƒë√°nh d·∫•u **@Primary**.

### Autowire primary datasource

```java
@Autowired
DataSource dataSource;
```

### Autowire non-primary datasource

```java
@Autowired
@Qualifier("h2DataSource")
DataSource dataSource;
```


# T√¨m hi·ªÉu c√°c Annotation : @RestController, @Service, @Repository, @Entity, @Table, @Id, @Transactional, @Query ...
## 1. @RestController
**@RestController** l√† m·ªôt phi√™n b·∫£n ƒë·∫∑c bi·ªát c·ªßa **@Controller**. N√≥ bao g·ªìm **@Controller** v√† **@ResponseBody** , v√† do ƒë√≥ n√≥ gi√∫p l√†m ƒë∆°n gi·∫£n h∆°n vi·ªác tri·ªÉn khai controller.
```java
@RestController
@RequestMapping("books-rest")
public class SimpleBookRestController {
    
    @GetMapping("/{id}", produces = "application/json")
    public Book getBook(@PathVariable int id) {
        return findBookById(id);
    }

    private Book findBookById(int id) {
        // ...
    }
}
```


**Annotation @RestController**
Spring cung c·∫•p hai annotation controller ch√≠nh:

* Annotation `@Controller` ƒë∆∞·ª£c s·ª≠ d·ª•ng cho c√°c ·ª©ng d·ª•ng d·ª±a tr√™n MVC, n∆°i m√† response th∆∞·ªùng l√† c√°c trang HTML.
* Annotation `@RestController` l√† m·ªôt phi√™n b·∫£n chuy√™n bi·ªát c·ªßa `@Controller` t·ª± ƒë·ªông tu·∫ßn t·ª± h√≥a (serialize) c√°c ƒë·ªëi t∆∞·ª£ng tr·∫£ v·ªÅ th√†nh c√°c response JSON/XML. N√≥ t∆∞∆°ng ƒë∆∞∆°ng v·ªõi `@Controller + @ResponseBody`.

Annotation n√†y ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü c·∫•p ƒë·ªô class v√† cho ph√©p class x·ª≠ l√Ω c√°c request ƒë∆∞·ª£c g·ª≠i t·ª´ client. `@RestController` cho ph√©p class x·ª≠ l√Ω c√°c request REST API nh∆∞ GET, POST, PUT v√† DELETE b·∫±ng c√°ch t·ª± ƒë·ªông tu·∫ßn t·ª± h√≥a (serialize) c√°c response th√†nh JSON.



## 2. @Serivce
**Annotation @Service trong Spring Boot**
Annotation `@Service` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ch·ªâ ra r·∫±ng m·ªôt class thu·ªôc v·ªÅ t·∫ßng service trong ·ª©ng d·ª•ng. T·∫ßng service th∆∞·ªùng ch·ª©a logic nghi·ªáp v·ª• c·ªßa ·ª©ng d·ª•ng. Annotation `@Service` l√† m·ªôt d·∫°ng chuy√™n bi·ªát c·ªßa annotation `@Component`, nghƒ©a l√† c√°c class ƒë∆∞·ª£c ƒë√°nh d·∫•u b·∫±ng `@Service` s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c Spring ph√°t hi·ªán trong qu√° tr√¨nh qu√©t classpath.

**C√°c ƒëi·ªÉm ch√≠nh v·ªÅ annotation @Service:**

* N√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë√°nh d·∫•u m·ªôt class l√† nh√† cung c·∫•p d·ªãch v·ª•.
* N√≥ ch·ªâ ƒë∆∞·ª£c √°p d·ª•ng cho c√°c class.
* N√≥ l√† m·ªôt ph·∫ßn c·ªßa c√°c stereotype annotations trong Spring (c√πng v·ªõi `@Controller`, `@Repository`, v√† `@Component`).
* Spring context s·∫Ω t·ª± ƒë·ªông ph√°t hi·ªán c√°c class n√†y khi s·ª≠ d·ª•ng c·∫•u h√¨nh d·ª±a tr√™n annotation v√† classpath scanning.
```java
// Java Program to Illustrate MyServiceClass

// Importing package module to code module
package com.example.demo.service;
// Importing required classes
import org.springframework.stereotype.Service;

// Annotation
@Service

// Class
public class MyServiceClass {

	// Method
	// To compute factorial
	public int factorial(int n)
	{
		// Base case
		if (n == 0)
			return 1;

		return n * factorial(n - 1);
	}
}
```
## 3. @Repository

### 3.1 Annotation @Repository trong Spring Boot

@Repository l√† m·ªôt d·∫°ng chuy√™n bi·ªát c·ªßa @Component, d√πng ƒë·ªÉ ch·ªâ ra r·∫±ng class n√†y cung c·∫•p c∆° ch·∫ø l∆∞u tr·ªØ, truy xu·∫•t, c·∫≠p nh·∫≠t, xo√° v√† t√¨m ki·∫øm d·ªØ li·ªáu tr√™n c√°c ƒë·ªëi t∆∞·ª£ng. M·∫∑c d√π l√† m·ªôt d·∫°ng c·ªßa @Component, c√°c l·ªõp Repository ƒë∆∞·ª£c Spring t·ª± ƒë·ªông ph√°t hi·ªán th√¥ng qua classpath scanning. Annotation n√†y g·∫ßn v·ªõi m√¥ h√¨nh DAO pattern, n∆°i c√°c l·ªõp DAO ch·ªãu tr√°ch nhi·ªám cung c·∫•p c√°c thao t√°c CRUD cho database.



### 3.2 **üîë C√°c ƒëi·ªÉm quan tr·ªçng c·ªßa @Repository**

* @Repository d√πng ƒë·ªÉ ƒë√°nh d·∫•u m·ªôt class l√† **Data Access Object (DAO)** hay **repository**.
* M·ª•c ƒë√≠ch ch√≠nh: t∆∞∆°ng t√°c v·ªõi **c∆° s·ªü d·ªØ li·ªáu**, ƒë√≥ng g√≥i logic truy v·∫•n d·ªØ li·ªáu.
* Cung c·∫•p **exception translation**: t·ª± ƒë·ªông chuy·ªÉn c√°c l·ªói truy c·∫≠p DB (SQLException,‚Ä¶) th√†nh DataAccessException c·ªßa Spring.
* Ch·ªâ ƒë∆∞·ª£c √°p d·ª•ng cho **class**, kh√¥ng √°p d·ª•ng cho method hay field.



### 3.3 V√≠ d·ª• minh h·ªça @Repository trong Spring Boot

#### V√≠ d·ª• 1: D√πng @Repository v·ªõi JdbcTemplate (DAO pattern truy·ªÅn th·ªëng)**

### **Entity: Student**

```java
public class Student {
    private int id;
    private String name;
    private int age;

    // getters + setters
}
```



### **Repository s·ª≠ d·ª•ng @Repository**

```java
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;
import java.util.List;

@Repository
public class StudentRepository {

    private final JdbcTemplate jdbcTemplate;

    public StudentRepository(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
    }

    public List<Student> findAll() {
        String sql = "SELECT * FROM students";
        return jdbcTemplate.query(
                sql,
                (rs, rowNum) -> {
                    Student s = new Student();
                    s.setId(rs.getInt("id"));
                    s.setName(rs.getString("name"));
                    s.setAge(rs.getInt("age"));
                    return s;
                }
        );
    }

    public int save(Student student) {
        String sql = "INSERT INTO students(name, age) VALUES(?, ?)";
        return jdbcTemplate.update(sql, student.getName(), student.getAge());
    }
}
```



### **V√≠ d·ª• 2: @Repository v·ªõi Spring Data JPA (c√°ch l√†m ph·ªï bi·∫øn nh·∫•t)**

Spring Boot cho ph√©p vi·∫øt repository **kh√¥ng c·∫ßn code truy v·∫•n**, ch·ªâ c·∫ßn extends t·ª´ JpaRepository.

### **Entity**

```java
import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import lombok.Data;

@Data
@Entity
public class Student {
    @Id
    private Integer id;
    private String name;
    private Integer age;
}
```



### **Spring Data Repository**

```java
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface StudentRepository extends JpaRepository<Student, Integer> {
    // Spring Data JPA s·∫Ω t·ª± t·∫°o CRUD methods
}
```



### **V√≠ d·ª• 3: @Repository Exception Translation**

N·∫øu x·∫£y ra SQLException, Spring s·∫Ω t·ª± chuy·ªÉn th√†nh DataAccessException:

```java
@Repository
public class BookRepository {

    @Autowired
    private JdbcTemplate jdbc;

    public void testError() {
        String sql = "SELECT * FROM table_not_exist"; // b·∫£ng kh√¥ng t·ªìn t·∫°i
        jdbc.queryForList(sql);  // n√©m l·ªói

        // SQLException s·∫Ω ƒë∆∞·ª£c Spring chuy·ªÉn th√†nh DataAccessException
    }
}
```

Kh√¥ng c·∫ßn try‚Äìcatch SQLException th·ªß c√¥ng.




## 4. @Table

### Spring Data JPA cung c·∫•p m·ªôt c√°ch thu·∫≠n ti·ªán ƒë·ªÉ l√†m vi·ªác v·ªõi c∆° s·ªü d·ªØ li·ªáu quan h·ªá th√¥ng qua c√°c √°nh x·∫° entity.

Annotation **@Table** ƒë∆∞·ª£c d√πng ƒë·ªÉ t√πy ch·ªânh c√°ch m·ªôt l·ªõp entity ƒë∆∞·ª£c √°nh x·∫° sang b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu. M·∫∑c ƒë·ªãnh, JPA s·ª≠ d·ª•ng t√™n l·ªõp l√†m t√™n b·∫£ng, nh∆∞ng v·ªõi @Table, developer c√≥ th·ªÉ ch·ªâ ƒë·ªãnh r√µ t√™n b·∫£ng, schema, catalog v√† c√°c r√†ng bu·ªôc unique.

### 4.1 M·ª•c ƒë√≠ch

Annotation **@Table** l√† m·ªôt ph·∫ßn c·ªßa ƒë·∫∑c t·∫£ Jakarta Persistence (JPA) v√† ƒë∆∞·ª£c ƒë·∫∑t ph√≠a tr√™n annotation @Entity trong class.

N√≥ ch·ªß y·∫øu ƒë∆∞·ª£c d√πng khi:

* T√™n b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu kh√°c v·ªõi t√™n l·ªõp entity
* C·∫ßn ƒë·ªãnh nghƒ©a schema ho·∫∑c catalog ƒë·ªÉ t·ªï ch·ª©c c∆° s·ªü d·ªØ li·ªáu
* C·∫ßn √°p ƒë·∫∑t r√†ng bu·ªôc unique tr√™n c√°c c·ªôt c·ª• th·ªÉ

### 4.2 C√∫ ph√°p:

```java
import jakarta.persistence.*;

@Entity
@Table(name = "student")  // Defines custom table name
public class Student { 
    // Fields and methods  
}
```

M·∫∑c ƒë·ªãnh, JPA s·∫Ω t·∫°o m·ªôt b·∫£ng t√™n l√† `Student` (kh·ªõp v·ªõi t√™n class).
S·ª≠ d·ª•ng `@Table(name = "student")`, t√™n b·∫£ng ƒë∆∞·ª£c ƒë·∫∑t r√µ r√†ng l√† `student`.


### 4.3 C√°c thu·ªôc t√≠nh c·ªßa @Table Annotation

* **name**: X√°c ƒë·ªãnh t√™n b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu (m·∫∑c ƒë·ªãnh l√† t√™n entity class)
* **catalog**: X√°c ƒë·ªãnh t√™n catalog c·ªßa CSDL
* **schema**: X√°c ƒë·ªãnh schema cho b·∫£ng
* **uniqueConstraints**: √Åp ƒë·∫∑t c√°c r√†ng bu·ªôc unique tr√™n m·ªôt ho·∫∑c nhi·ªÅu c·ªôt

### 4.4 V√≠ d·ª•: S·ª≠ d·ª•ng @Table v·ªõi Unique Constraint

```java
import jakarta.persistence.*;

@Entity
@Table(
    name = "EMPLOYEE",
    uniqueConstraints = { @UniqueConstraint(columnNames = "email") }
)
public class Employee {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;

    @Column(nullable = false, unique = true)
    private String email;
}
```

* T√™n b·∫£ng ƒë∆∞·ª£c ƒë·∫∑t r√µ r√†ng l√† **EMPLOYEE**.
* M·ªôt unique constraint ƒë∆∞·ª£c th√™m v√†o c·ªôt **email**, ƒë·∫£m b·∫£o kh√¥ng c√≥ hai record n√†o c√≥ c√πng ƒë·ªãa ch·ªâ email.
* `@Column(unique = true)` ƒë·∫£m b·∫£o t√≠nh unique ·ªü m·ª©c c·ªôt, trong khi `@UniqueConstraint` √°p d·ª•ng ·ªü m·ª©c b·∫£ng.



N·∫øu b·∫°n mu·ªën m√¨nh d·ªãch ti·∫øp c√°c b√†i JPA kh√°c, c·ª© g·ª≠i nh√©!
## 5. @Id
D∆∞·ªõi ƒë√¢y l√† **b·∫£n d·ªãch ƒë·∫ßy ƒë·ªß, gi·ªØ nguy√™n n·ªôi dung g·ªëc, kh√¥ng r√∫t g·ªçn, kh√¥ng s·ª≠a √Ω**, ch·ªâ d·ªãch sang ti·∫øng Vi·ªát v√† format r√µ r√†ng:



### 5.1 Annotation @Id

Annotation **@Id** ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong package `jakarta.persistence` (ho·∫∑c `javax.persistence` trong c√°c phi√™n b·∫£n c≈©). N√≥ ƒë∆∞·ª£c d√πng ƒë·ªÉ ƒë√°nh d·∫•u m·ªôt field l√† **primary key** c·ªßa m·ªôt entity trong JPA.

Khi ƒë∆∞·ª£c s·ª≠ d·ª•ng c√πng annotation **@GeneratedValue**, n√≥ cho ph√©p t·ª± ƒë·ªông t·∫°o ra c√°c ID duy nh·∫•t cho c√°c b·∫£n ghi m·ªõi.



### 5.2 C√∫ ph√°p:

```java
import jakarta.persistence.*;

@Entity
public class ExampleEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
}
```

* **@Id** x√°c ƒë·ªãnh r·∫±ng field n√†y l√† primary key trong b·∫£ng c∆° s·ªü d·ªØ li·ªáu.
* N√≥ c√≥ th·ªÉ √°p d·ª•ng cho c√°c ki·ªÉu nguy√™n th·ªßy ho·∫∑c wrapper (`int, long, Integer, Long`, v.v.).
* ƒê√¢y l√† b·∫Øt bu·ªôc trong m·ªçi entity ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi JPA.
* Th∆∞·ªùng ƒë∆∞·ª£c k·∫øt h·ª£p v·ªõi **@GeneratedValue** ƒë·ªÉ t·ª± ƒë·ªông sinh ID.


### 5.3 C√°c chi·∫øn l∆∞·ª£c ph·ªï bi·∫øn c·ªßa @GeneratedValue

**GenerationType.IDENTITY**

* S·ª≠ d·ª•ng c·ªôt identity c·ªßa c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ auto-increment.
* Ph·ªï bi·∫øn trong MySQL.

**GenerationType.SEQUENCE**

* S·ª≠ d·ª•ng m·ªôt database sequence ƒë·ªÉ t·∫°o ID.
* Ph·ªï bi·∫øn trong PostgreSQL v√† Oracle.

**GenerationType.TABLE**

* S·ª≠ d·ª•ng m·ªôt b·∫£ng ri√™ng ƒë·ªÉ qu·∫£n l√Ω v√† t·∫°o c√°c ID duy nh·∫•t.

**GenerationType.AUTO**

* JPA t·ª± ƒë·ªông ch·ªçn chi·∫øn l∆∞·ª£c t·∫°o ID d·ª±a tr√™n lo·∫°i c∆° s·ªü d·ªØ li·ªáu b√™n d∆∞·ªõi.

## 6. @Transactional    



### 6.1 Trong c√°c ·ª©ng d·ª•ng doanh nghi·ªáp, giao d·ªãch (transaction) ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n v√† to√†n v·∫πn d·ªØ li·ªáu.

M·ªôt transaction l√† m·ªôt chu·ªói c√°c thao t√°c ƒë∆∞·ª£c th·ª±c hi·ªán nh∆∞ m·ªôt ƒë∆°n v·ªã c√¥ng vi·ªác logic duy nh·∫•t.
Ho·∫∑c **t·∫•t c·∫£ thao t√°c trong transaction th√†nh c√¥ng (commit)**, ho·∫∑c **kh√¥ng c√≥ thao t√°c n√†o ƒë∆∞·ª£c th·ª±c hi·ªán (rollback)**.

Spring Boot ƒë∆°n gi·∫£n h√≥a vi·ªác qu·∫£n l√Ω transaction th√¥ng qua annotation **@Transactional**, ƒë∆∞·ª£c x√¢y d·ª±ng d·ª±a tr√™n c∆° ch·∫ø transaction khai b√°o (declarative transaction management) c·ªßa Spring.
N√≥ gi√∫p developer kh√¥ng c·∫ßn vi·∫øt code l·∫∑p l·∫°i ƒë·ªÉ qu·∫£n l√Ω transaction th·ªß c√¥ng.



### 6.2 What is Transaction Management?

Qu·∫£n l√Ω transaction l√† qu√° tr√¨nh ƒëi·ªÅu ph·ªëi c√°c thao t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ ƒë·∫£m b·∫£o tu√¢n th·ªß c√°c thu·ªôc t√≠nh **ACID**:

* **Atomicity**: T·∫•t c·∫£ ho·∫∑c kh√¥ng g√¨ c·∫£.
* **Consistency**: CSDL ph·∫£i h·ª£p l·ªá tr∆∞·ªõc v√† sau transaction.
* **Isolation**: C√°c transaction ch·∫°y ƒë·ªìng th·ªùi kh√¥ng ·∫£nh h∆∞·ªüng l·∫´n nhau.
* **Durability**: D·ªØ li·ªáu sau commit ph·∫£i t·ªìn t·∫°i k·ªÉ c·∫£ khi h·ªá th·ªëng g·∫∑p s·ª± c·ªë.

**V√≠ d·ª•:** Trong h·ªá th·ªëng ng√¢n h√†ng, n·∫øu b·∫°n chuy·ªÉn ti·ªÅn:

1. Tr·ª´ ti·ªÅn t·ª´ t√†i kho·∫£n A
2. C·ªông ti·ªÅn v√†o t√†i kho·∫£n B

C·∫£ hai thao t√°c ph·∫£i c√πng **th√†nh c√¥ng** ho·∫∑c c√πng **th·∫•t b·∫°i**.



### 6.3 @Transactional Annotation

Annotation **@Transactional**:

* T·ª± ƒë·ªông b·∫Øt ƒë·∫ßu m·ªôt transaction khi method ƒë∆∞·ª£c g·ªçi
* Commit transaction n·∫øu method ch·∫°y ho√†n t·∫•t th√†nh c√¥ng
* Rollback transaction n·∫øu x·∫£y ra runtime exception
* Gi·∫£m thi·ªÉu vi·ªác vi·∫øt code boilerplate ƒë·ªÉ x·ª≠ l√Ω transaction

**Ghi ch√∫:**
N·∫øu b·∫°n s·ª≠ d·ª•ng `spring-boot-starter-data-jpa`, Spring Boot s·∫Ω t·ª± ƒë·ªông c·∫•u h√¨nh transaction management.
B·∫°n **kh√¥ng c·∫ßn** th√™m `@EnableTransactionManagement` ‚Äî ch·ªâ th√™m n·∫øu b·∫°n **kh√¥ng d√πng JPA starter** ho·∫∑c mu·ªën t·ª± c·∫•u h√¨nh transaction theo c√°ch ri√™ng.

## 7. @Query
D∆∞·ªõi ƒë√¢y l√† **b·∫£n d·ªãch ƒë·∫ßy ƒë·ªß, gi·ªØ nguy√™n n·ªôi dung g·ªëc ‚Äî kh√¥ng r√∫t g·ªçn, kh√¥ng s·ª≠a √Ω**, ch·ªâ d·ªãch sang ti·∫øng Vi·ªát v√† tr√¨nh b√†y r√µ r√†ng:



## Spring Data JPA ho·∫∑c JPA l√† vi·∫øt t·∫Øt c·ªßa Java Persistence API, v√¨ v·∫≠y tr∆∞·ªõc khi t√¨m hi·ªÉu v·ªÅ n√≥, ch√∫ng ta c·∫ßn bi·∫øt v·ªÅ ORM (Object Relation Mapping).

ORM ƒë∆°n gi·∫£n l√† qu√° tr√¨nh l∆∞u tr·ªØ (persist) b·∫•t k·ª≥ ƒë·ªëi t∆∞·ª£ng Java n√†o tr·ª±c ti·∫øp v√†o b·∫£ng c·ªßa c∆° s·ªü d·ªØ li·ªáu.

Annotation **@Query** ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë·ªãnh nghƒ©a c√°c truy v·∫•n t√πy ch·ªânh trong Spring Data JPA.
Khi b·∫°n kh√¥ng th·ªÉ d√πng c√°c ph∆∞∆°ng th·ª©c truy v·∫•n (query methods) ƒë·ªÉ th·ª±c hi·ªán thao t√°c v·ªõi CSDL, b·∫°n c√≥ th·ªÉ d√πng **@Query** ƒë·ªÉ vi·∫øt truy v·∫•n linh ho·∫°t h∆°n nh·∫±m truy xu·∫•t d·ªØ li·ªáu.

M·ªôt v√†i ƒëi·ªÉm c·∫ßn nh·ªõ v·ªÅ annotation **@Query** ƒë∆∞·ª£c li·ªát k√™ d∆∞·ªõi ƒë√¢y:

* **@Query h·ªó tr·ª£ c·∫£ JPQL v√† native SQL queries.**
* **N√≥ c≈©ng h·ªó tr·ª£ SpEL expressions.**
* **@Param** trong tham s·ªë method ƒë·ªÉ bind gi√° tr·ªã v√†o tham s·ªë truy v·∫•n.

Nh∆∞ ƒë√£ th·∫£o lu·∫≠n, v·ªõi s·ª± h·ªó tr·ª£ c·ªßa **@Query Annotation** trong Spring Data JPA, ch√∫ng ta c√≥ th·ªÉ th·ª±c thi c·∫£ truy v·∫•n **JPQL** v√† **native SQL**.
D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë v√≠ d·ª•.



## V√≠ d·ª•:

### JPQL:

```java
@Query("SELECT * FROM Student ORDER BY age")
Optional<Student> findSortedStudentByAge();
```



### Native:

N·∫øu b·∫°n mu·ªën s·ª≠ d·ª•ng native query trong d·ª± √°n Spring Boot th√¨ c·∫ßn d√πng annotation **@Query** v√† ƒë·∫∑t thu·ªôc t√≠nh `nativeQuery = true` ƒë·ªÉ ƒë√°nh d·∫•u truy v·∫•n n√†y l√† native query.

```java
@Query(nativeQuery = true, value = "SELECT * FROM Student ORDER BY age")
Optional<Student> findSortedStudentByAge();
```

# B√†i t·∫≠p: Ch·ªçn 1 module c·ªßa 1 ƒë·ªÅ t√†i trong sheet b√™n d∆∞·ªõi, l√†m 1 ·ª©ng d·ª•ng v·ªõi module ƒë√≥. D√πng @RestController ƒë·ªÉ vi·∫øt endpoint c·ªßa API, d√πng @Service ƒë·ªÉ x·ª≠ l√Ω c√°c logic CRUD, @Repository ƒë·ªÉ x·ª≠ l√Ω thao t√°c v·ªõi database, @Entity ƒë·ªÉ t·∫°o c√°c ORM v·ªõi DB
# L∆∞u √Ω √°p d·ª•ng t·∫•t c·∫£ c√°c Annotation ƒë√£ t√¨m hi·ªÉu
